!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define(["three"],e):"object"==typeof exports?exports.Norska=e(require("three")):t.Norska=e(t.three)}(self,(t=>(()=>{"use strict";var e={881:e=>{e.exports=t}},i={};function n(t){var o=i[t];if(void 0!==o)return o.exports;var s=i[t]={exports:{}};return e[t](s,s.exports,n),s.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{n.r(o),n.d(o,{default:()=>Le});var t=n(881),e=function(t,e){t&&Object.keys(e).forEach((function(i,n){t[n]&&(e[i]=t[n])}))};const i={BoxGeometry:function(i){var n={width:1,height:1,depth:1,widthSegments:1,heightSegments:1,depthSegments:1};return e(i,n),new(t.BoxGeometry.bind.apply(t.BoxGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},CapsuleGeometry:function(i){var n={radius:1,length:1,capSubdivisions:1,radialSegments:1};return e(i,n),new(t.CapsuleGeometry.bind.apply(t.CapsuleGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},CircleGeometry:function(i){var n={radius:1,segments:8,thetaStart:0,thetaLength:2*Math.PI};return e(i,n),new(t.CircleGeometry.bind.apply(t.CircleGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},ConeGeometry:function(i){var n={radius:1,height:1,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2*Math.PI};return e(i,n),new(t.ConeGeometry.bind.apply(t.ConeGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},CylinderGeometry:function(i){var n={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2*Math.PI};return e(i,n),new(t.CylinderGeometry.bind.apply(t.CylinderGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},DodecahedronGeometry:function(i){var n={radius:1,detail:0};return e(i,n),new(t.DodecahedronGeometry.bind.apply(t.DodecahedronGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},EdgesGeometry:function(i){var n={geometry:null,thresholdAngle:1};return e(i,n),new(t.EdgesGeometry.bind.apply(t.EdgesGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},ExtrudeGeometry:function(i){var n={shapes:null,options:null};return e(i,n),new(t.ExtrudeGeometry.bind.apply(t.ExtrudeGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},IcosahedronGeometry:function(i){var n={radius:1,detail:0};return e(i,n),new(t.IcosahedronGeometry.bind.apply(t.IcosahedronGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},LatheGeometry:function(i){var n={points:null,segments:12,phiStart:0,phiLength:2*Math.PI};return e(i,n),new(t.LatheGeometry.bind.apply(t.LatheGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},OctahedronGeometry:function(i){var n={radius:1,detail:0};return e(i,n),new(t.OctahedronGeometry.bind.apply(t.OctahedronGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},PlaneGeometry:function(i){var n={width:1,height:1,widthSegments:1,heightSegments:1};return e(i,n),new(t.PlaneGeometry.bind.apply(t.PlaneGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},PolyhedronGeometry:function(i){var n={vertices:null,indices:null,radius:1,detail:0};return e(i,n),new(t.PolyhedronGeometry.bind.apply(t.PolyhedronGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},RingGeometry:function(i){var n={innerRadius:.5,outerRadius:1,thetaSegments:8,phiSegments:8,thetaStart:0,thetaLength:2*Math.PI};return e(i,n),new(t.RingGeometry.bind.apply(t.RingGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},ShapeGeometry:function(i){var n={shapes:null,curveSegments:12};return e(i,n),new(t.ShapeGeometry.bind.apply(t.ShapeGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},SphereGeometry:function(i){var n={radius:1,widthSegments:32,heightSegments:16,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI};return e(i,n),new(t.SphereGeometry.bind.apply(t.SphereGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},TetrahedronGeometry:function(i){var n={radius:1,detail:0};return e(i,n),new(t.TetrahedronGeometry.bind.apply(t.TetrahedronGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},TorusGeometry:function(i){var n={radius:1,tube:.4,radialSegments:8,tubularSegments:6,arc:2*Math.PI};return e(i,n),new(t.TorusGeometry.bind.apply(t.TorusGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},TorusKnotGeometry:function(i){var n={radius:1,tube:.4,tubularSegments:64,radialSegments:8,p:2,q:3};return e(i,n),new(t.TorusKnotGeometry.bind.apply(t.TorusKnotGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},TubeGeometry:function(i){var n={path:null,tubularSegments:64,radius:1,radiusSegments:8,closed:!1};return e(i,n),new(t.TubeGeometry.bind.apply(t.TubeGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},WireframeGeometry:function(i){var n={geometry:null};return e(i,n),new(t.WireframeGeometry.bind.apply(t.WireframeGeometry,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))}};var s=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r},r=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r};const a={AmbientLight:function(i){var n={color:16777215,intensity:1};return e(i,n),new(t.AmbientLight.bind.apply(t.AmbientLight,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},DirectionalLight:function(i){var n={color:16777215,intensity:1};return e(i,n),new(t.DirectionalLight.bind.apply(t.DirectionalLight,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},HemisphereLight:function(i){var n={skyColor:16777215,groundColor:16777215,intensity:1};return e(i,n),new(t.HemisphereLight.bind.apply(t.HemisphereLight,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},PointLight:function(i){var n={color:16777215,intensity:1,distance:0,decay:1};return e(i,n),new(t.PointLight.bind.apply(t.PointLight,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},SpotLight:function(i){var n={color:16777215,intensity:1,distance:0,angle:Math.PI/2,penumbra:0,decay:1};return e(i,n),new(t.SpotLight.bind.apply(t.SpotLight,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))},RectAreaLight:function(i){var n={color:16777215,intensity:1,width:10,height:10};return e(i,n),new(t.RectAreaLight.bind.apply(t.RectAreaLight,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([void 0],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(Object.values(n)),!1)))}};var c=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r},h=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r},l=function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},u=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r},m=function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},p=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r},d=function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))};class f extends t.Loader{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new b(t)})),this.register((function(t){return new P(t)})),this.register((function(t){return new R(t)})),this.register((function(t){return new x(t)})),this.register((function(t){return new E(t)})),this.register((function(t){return new S(t)})),this.register((function(t){return new T(t)})),this.register((function(t){return new w(t)})),this.register((function(t){return new A(t)})),this.register((function(t){return new M(t)})),this.register((function(t){return new _(t)})),this.register((function(t){return new L(t)})),this.register((function(t){return new C(t)}))}load(e,i,n,o){const s=this;let r;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:t.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const a=function(t){o?o(t):console.error(t),s.manager.itemError(e),s.manager.itemEnd(e)},c=new t.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,(function(t){try{s.parse(t,r,(function(t){i(t),s.manager.itemEnd(e)}),a)}catch(t){a(t)}}),n,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(e,i,n,o){let s;const r={},a={};if("string"==typeof e)s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(t.LoaderUtils.decodeText(new Uint8Array(e,0,4))===O){try{r[v.KHR_BINARY_GLTF]=new I(e)}catch(t){return void(o&&o(t))}s=JSON.parse(r[v.KHR_BINARY_GLTF].content)}else s=JSON.parse(t.LoaderUtils.decodeText(new Uint8Array(e)));else s=e;if(void 0===s.asset||s.asset.version[0]<2)return void(o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new it(s,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](c);a[e.name]=e,r[e.name]=!0}if(s.extensionsUsed)for(let t=0;t<s.extensionsUsed.length;++t){const e=s.extensionsUsed[t],i=s.extensionsRequired||[];switch(e){case v.KHR_MATERIALS_UNLIT:r[e]=new g;break;case v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[e]=new z;break;case v.KHR_DRACO_MESH_COMPRESSION:r[e]=new k(s,this.dracoLoader);break;case v.KHR_TEXTURE_TRANSFORM:r[e]=new N;break;case v.KHR_MESH_QUANTIZATION:r[e]=new D;break;default:i.indexOf(e)>=0&&void 0===a[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}c.setExtensions(r),c.setPlugins(a),c.parse(n,o)}parseAsync(t,e){const i=this;return new Promise((function(n,o){i.parse(t,e,n,o)}))}}function y(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const v={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class _{constructor(t){this.parser=t,this.name=v.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const i=this.parser,n="light:"+e;let o=i.cache.get(n);if(o)return o;const s=i.json,r=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let a;const c=new t.Color(16777215);void 0!==r.color&&c.fromArray(r.color);const h=void 0!==r.range?r.range:0;switch(r.type){case"directional":a=new t.DirectionalLight(c),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new t.PointLight(c),a.distance=h;break;case"spot":a=new t.SpotLight(c),a.distance=h,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,a.angle=r.spot.outerConeAngle,a.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return a.position.set(0,0,0),a.decay=2,void 0!==r.intensity&&(a.intensity=r.intensity),a.name=i.createUniqueName(r.name||"light_"+e),o=Promise.resolve(a),i.cache.add(n,o),o}createNodeAttachment(t){const e=this,i=this.parser,n=i.json.nodes[t],o=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then((function(t){return i._getNodeRef(e.cache,o,t)}))}}class g{constructor(){this.name=v.KHR_MATERIALS_UNLIT}getMaterialType(){return t.MeshBasicMaterial}extendParams(e,i,n){const o=[];e.color=new t.Color(1,1,1),e.opacity=1;const s=i.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const t=s.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==s.baseColorTexture&&o.push(n.assignTexture(e,"map",s.baseColorTexture,t.sRGBEncoding))}return Promise.all(o)}}class w{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(e.emissiveIntensity=n),Promise.resolve()}}class b{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],r=o.extensions[this.name];if(void 0!==r.clearcoatFactor&&(i.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&s.push(n.assignTexture(i,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(i.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&s.push(n.assignTexture(i,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(s.push(n.assignTexture(i,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const e=r.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new t.Vector2(e,e)}return Promise.all(s)}}class M{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return void 0!==s.iridescenceFactor&&(e.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&o.push(i.assignTexture(e,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(e.iridescenceIOR=s.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&o.push(i.assignTexture(e,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(o)}}class x{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[];i.sheenColor=new t.Color(0,0,0),i.sheenRoughness=0,i.sheen=1;const r=o.extensions[this.name];return void 0!==r.sheenColorFactor&&i.sheenColor.fromArray(r.sheenColorFactor),void 0!==r.sheenRoughnessFactor&&(i.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&s.push(n.assignTexture(i,"sheenColorMap",r.sheenColorTexture,t.sRGBEncoding)),void 0!==r.sheenRoughnessTexture&&s.push(n.assignTexture(i,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class E{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&o.push(i.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(o)}}class S{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],r=o.extensions[this.name];i.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&s.push(n.assignTexture(i,"thicknessMap",r.thicknessTexture)),i.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return i.attenuationColor=new t.Color(a[0],a[1],a[2]),Promise.all(s)}}class T{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return e.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class A{constructor(t){this.parser=t,this.name=v.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?t.MeshPhysicalMaterial:null}extendMaterialParams(e,i){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],r=o.extensions[this.name];i.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&s.push(n.assignTexture(i,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return i.specularColor=new t.Color(a[0],a[1],a[2]),void 0!==r.specularColorTexture&&s.push(n.assignTexture(i,"specularColorMap",r.specularColorTexture,t.sRGBEncoding)),Promise.all(s)}}class P{constructor(t){this.parser=t,this.name=v.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,n=i.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const o=n.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,o.source,s)}}class R{constructor(t){this.parser=t,this.name=v.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,o=n.textures[t];if(!o.extensions||!o.extensions[e])return null;const s=o.extensions[e],r=n.images[s.source];let a=i.textureLoader;if(r.uri){const t=i.options.manager.getHandler(r.uri);null!==t&&(a=t)}return this.detectSupport().then((function(o){if(o)return i.loadTextureImage(t,s.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class L{constructor(t){this.name=v.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const t=i.extensions[this.name],n=this.parser.getDependency("buffer",t.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(e){const i=t.byteOffset||0,n=t.byteLength||0,s=t.count,r=t.byteStride,a=new Uint8Array(e,i,n);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(s,r,a,t.mode,t.filter).then((function(t){return t.buffer})):o.ready.then((function(){const e=new ArrayBuffer(s*r);return o.decodeGltfBuffer(new Uint8Array(e),s,r,a,t.mode,t.filter),e}))}))}return null}}class C{constructor(t){this.name=v.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(e){const i=this.parser.json,n=i.nodes[e];if(!n.extensions||!n.extensions[this.name]||void 0===n.mesh)return null;const o=i.meshes[n.mesh];for(const t of o.primitives)if(t.mode!==V.TRIANGLES&&t.mode!==V.TRIANGLE_STRIP&&t.mode!==V.TRIANGLE_FAN&&void 0!==t.mode)return null;const s=n.extensions[this.name].attributes,r=[],a={};for(const t in s)r.push(this.parser.getDependency("accessor",s[t]).then((e=>(a[t]=e,a[t]))));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then((e=>{const i=e.pop(),n=i.isGroup?i.children:[i],o=e[0].count,s=[];for(const e of n){const i=new t.Matrix4,n=new t.Vector3,r=new t.Quaternion,c=new t.Vector3(1,1,1),h=new t.InstancedMesh(e.geometry,e.material,o);for(let t=0;t<o;t++)a.TRANSLATION&&n.fromBufferAttribute(a.TRANSLATION,t),a.ROTATION&&r.fromBufferAttribute(a.ROTATION,t),a.SCALE&&c.fromBufferAttribute(a.SCALE,t),h.setMatrixAt(t,i.compose(n,r,c));for(const t in a)"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);t.Object3D.prototype.copy.call(h,e),h.frustumCulled=!1,this.parser.assignFinalMaterial(h),s.push(h)}return i.isGroup?(i.clear(),i.add(...s),i):s[0]})))}}const O="glTF";class I{constructor(e){this.name=v.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,12);if(this.header={magic:t.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==O)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,o=new DataView(e,12);let s=0;for(;s<n;){const i=o.getUint32(s,!0);s+=4;const n=o.getUint32(s,!0);if(s+=4,1313821514===n){const n=new Uint8Array(e,12+s,i);this.content=t.LoaderUtils.decodeText(n)}else if(5130562===n){const t=12+s;this.body=e.slice(t,t+i)}s+=i}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class k{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=v.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,n=this.dracoLoader,o=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,r={},a={},c={};for(const t in s){const e=Z[t]||t.toLowerCase();r[e]=s[t]}for(const e in t.attributes){const n=Z[e]||e.toLowerCase();if(void 0!==s[e]){const o=i.accessors[t.attributes[e]],s=H[o.componentType];c[n]=s.name,a[n]=!0===o.normalized}}return e.getDependency("bufferView",o).then((function(t){return new Promise((function(e){n.decodeDracoFile(t,(function(t){for(const e in t.attributes){const i=t.attributes[e],n=a[e];void 0!==n&&(i.normalized=n)}e(t)}),r,c)}))}))}}class N{constructor(){this.name=v.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class F extends t.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new t.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(t){for(const e in a)t.uniforms[e]=a[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(t){a.specular.value=t}},specularMap:{get:function(){return a.specularMap.value},set:function(t){a.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(t){a.glossiness.value=t}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(t){a.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class z{constructor(){this.name=v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return F}extendParams(e,i,n){const o=i.extensions[this.name];e.color=new t.Color(1,1,1),e.opacity=1;const s=[];if(Array.isArray(o.diffuseFactor)){const t=o.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==o.diffuseTexture&&s.push(n.assignTexture(e,"map",o.diffuseTexture,t.sRGBEncoding)),e.emissive=new t.Color(0,0,0),e.glossiness=void 0!==o.glossinessFactor?o.glossinessFactor:1,e.specular=new t.Color(1,1,1),Array.isArray(o.specularFactor)&&e.specular.fromArray(o.specularFactor),void 0!==o.specularGlossinessTexture){const i=o.specularGlossinessTexture;s.push(n.assignTexture(e,"glossinessMap",i)),s.push(n.assignTexture(e,"specularMap",i,t.sRGBEncoding))}return Promise.all(s)}createMaterial(e){const i=new F(e);return i.fog=!0,i.color=e.color,i.map=void 0===e.map?null:e.map,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=void 0===e.aoMap?null:e.aoMap,i.aoMapIntensity=1,i.emissive=e.emissive,i.emissiveIntensity=void 0===e.emissiveIntensity?1:e.emissiveIntensity,i.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,i.bumpMap=void 0===e.bumpMap?null:e.bumpMap,i.bumpScale=1,i.normalMap=void 0===e.normalMap?null:e.normalMap,i.normalMapType=t.TangentSpaceNormalMap,e.normalScale&&(i.normalScale=e.normalScale),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=void 0===e.specularMap?null:e.specularMap,i.specular=e.specular,i.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,i.glossiness=e.glossiness,i.alphaMap=null,i.envMap=void 0===e.envMap?null:e.envMap,i.envMapIntensity=1,i}}class D{constructor(){this.name=v.KHR_MESH_QUANTIZATION}}class j extends t.Interpolant{constructor(t,e,i,n){super(t,e,i,n)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,o=t*n*3+n;for(let t=0;t!==n;t++)e[t]=i[o+t];return e}interpolate_(t,e,i,n){const o=this.resultBuffer,s=this.sampleValues,r=this.valueSize,a=2*r,c=3*r,h=n-e,l=(i-e)/h,u=l*l,m=u*l,p=t*c,d=p-c,f=-2*m+3*u,y=m-u,v=1-f,_=y-u+l;for(let t=0;t!==r;t++){const e=s[d+t+r],i=s[d+t+a]*h,n=s[p+t+r],c=s[p+t]*h;o[t]=v*e+_*i+f*n+y*c}return o}}const G=new t.Quaternion;class U extends j{interpolate_(t,e,i,n){const o=super.interpolate_(t,e,i,n);return G.fromArray(o).normalize().toArray(o),o}}const V={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},H={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},X={9728:t.NearestFilter,9729:t.LinearFilter,9984:t.NearestMipmapNearestFilter,9985:t.LinearMipmapNearestFilter,9986:t.NearestMipmapLinearFilter,9987:t.LinearMipmapLinearFilter},Y={33071:t.ClampToEdgeWrapping,33648:t.MirroredRepeatWrapping,10497:t.RepeatWrapping},B={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Z={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},K={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},q={CUBICSPLINE:void 0,LINEAR:t.InterpolateLinear,STEP:t.InterpolateDiscrete};function Q(t,e,i){for(const n in i.extensions)void 0===t[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=i.extensions[n])}function W(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function J(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let i=0,n=e.weights.length;i<n;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let e=0,n=i.length;e<n;e++)t.morphTargetDictionary[i[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function $(t){const e=t.extensions&&t.extensions[v.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+tt(e.attributes):t.indices+":"+tt(t.attributes)+":"+t.mode,i}function tt(t){let e="";const i=Object.keys(t).sort();for(let n=0,o=i.length;n<o;n++)e+=i[n]+":"+t[i[n]]+";";return e}function et(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class it{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new y,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=navigator.userAgent.indexOf("Firefox")>-1,s=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;"undefined"==typeof createImageBitmap||n||o&&s<98?this.textureLoader=new t.TextureLoader(this.options.manager):this.textureLoader=new t.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new t.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,n=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(e){const s={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:i,userData:{}};Q(o,s,n),W(s,n),Promise.all(i._invokeAll((function(t){return t.afterRoot&&t.afterRoot(s)}))).then((function(){t(s)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let e=0,n=t.length;e<n;e++){const n=t[e];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(i[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const n=i.clone(),o=(t,e)=>{const i=this.associations.get(t);null!=i&&this.associations.set(e,i);for(const[i,n]of t.children.entries())o(n,e.children[i])};return o(i,n),n.name+="_instance_"+t.uses[e]++,n}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const n=t(e[i]);if(n)return n}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let n=0;n<e.length;n++){const o=t(e[n]);o&&i.push(o)}return i}getDependency(t,e){const i=t+":"+e;let n=this.cache.get(i);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this.loadNode(e);break;case"mesh":n=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":n=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":n=this.loadSkin(e);break;case"animation":n=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":n=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(i,n)}return n}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,n=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(n.map((function(e,n){return i.getDependency(t,n)}))),this.cache.add(t,e)}return e}loadBuffer(e){const i=this.json.buffers[e],n=this.fileLoader;if(i.type&&"arraybuffer"!==i.type)throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(void 0===i.uri&&0===e)return Promise.resolve(this.extensions[v.KHR_BINARY_GLTF].body);const o=this.options;return new Promise((function(e,s){n.load(t.LoaderUtils.resolveURL(i.uri,o.path),e,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const i=e.byteLength||0,n=e.byteOffset||0;return t.slice(n,n+i)}))}loadAccessor(e){const i=this,n=this.json,o=this.json.accessors[e];if(void 0===o.bufferView&&void 0===o.sparse)return Promise.resolve(null);const s=[];return void 0!==o.bufferView?s.push(this.getDependency("bufferView",o.bufferView)):s.push(null),void 0!==o.sparse&&(s.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(s).then((function(e){const s=e[0],r=B[o.type],a=H[o.componentType],c=a.BYTES_PER_ELEMENT,h=c*r,l=o.byteOffset||0,u=void 0!==o.bufferView?n.bufferViews[o.bufferView].byteStride:void 0,m=!0===o.normalized;let p,d;if(u&&u!==h){const e=Math.floor(l/u),n="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+e+":"+o.count;let h=i.cache.get(n);h||(p=new a(s,e*u,o.count*u/c),h=new t.InterleavedBuffer(p,u/c),i.cache.add(n,h)),d=new t.InterleavedBufferAttribute(h,r,l%u/c,m)}else p=null===s?new a(o.count*r):new a(s,l,o.count*r),d=new t.BufferAttribute(p,r,m);if(void 0!==o.sparse){const i=B.SCALAR,n=H[o.sparse.indices.componentType],c=o.sparse.indices.byteOffset||0,h=o.sparse.values.byteOffset||0,l=new n(e[1],c,o.sparse.count*i),u=new a(e[2],h,o.sparse.count*r);null!==s&&(d=new t.BufferAttribute(d.array.slice(),d.itemSize,d.normalized));for(let t=0,e=l.length;t<e;t++){const e=l[t];if(d.setX(e,u[t*r]),r>=2&&d.setY(e,u[t*r+1]),r>=3&&d.setZ(e,u[t*r+2]),r>=4&&d.setW(e,u[t*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d}))}loadTexture(t){const e=this.json,i=this.options,n=e.textures[t].source,o=e.images[n];let s=this.textureLoader;if(o.uri){const t=i.manager.getHandler(o.uri);null!==t&&(s=t)}return this.loadTextureImage(t,n,s)}loadTextureImage(e,i,n){const o=this,s=this.json,r=s.textures[e],a=s.images[i],c=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[c])return this.textureCache[c];const h=this.loadImageSource(i,n).then((function(i){i.flipY=!1,i.name=r.name||a.name||"";const n=(s.samplers||{})[r.sampler]||{};return i.magFilter=X[n.magFilter]||t.LinearFilter,i.minFilter=X[n.minFilter]||t.LinearMipmapLinearFilter,i.wrapS=Y[n.wrapS]||t.RepeatWrapping,i.wrapT=Y[n.wrapT]||t.RepeatWrapping,o.associations.set(i,{textures:e}),i})).catch((function(){return null}));return this.textureCache[c]=h,h}loadImageSource(e,i){const n=this.json,o=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((t=>t.clone()));const s=n.images[e],r=self.URL||self.webkitURL;let a=s.uri||"",c=!1;if(void 0!==s.bufferView)a=this.getDependency("bufferView",s.bufferView).then((function(t){c=!0;const e=new Blob([t],{type:s.mimeType});return a=r.createObjectURL(e),a}));else if(void 0===s.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(a).then((function(e){return new Promise((function(n,s){let r=n;!0===i.isImageBitmapLoader&&(r=function(e){const i=new t.Texture(e);i.needsUpdate=!0,n(i)}),i.load(t.LoaderUtils.resolveURL(e,o.path),r,void 0,s)}))})).then((function(t){var e;return!0===c&&r.revokeObjectURL(a),t.userData.mimeType=s.mimeType||((e=s.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),t}));return this.sourceCache[e]=h,h}assignTexture(t,e,i,n){const o=this;return this.getDependency("texture",i.index).then((function(s){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===e&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+e+" not yet supported."),o.extensions[v.KHR_TEXTURE_TRANSFORM]){const t=void 0!==i.extensions?i.extensions[v.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=o.associations.get(s);s=o.extensions[v.KHR_TEXTURE_TRANSFORM].extendTexture(s,t),o.associations.set(s,e)}}return void 0!==n&&(s.encoding=n),t[e]=s,s}))}assignFinalMaterial(e){const i=e.geometry;let n=e.material;const o=void 0===i.attributes.tangent,s=void 0!==i.attributes.color,r=void 0===i.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let i=this.cache.get(e);i||(i=new t.PointsMaterial,t.Material.prototype.copy.call(i,n),i.color.copy(n.color),i.map=n.map,i.sizeAttenuation=!1,this.cache.add(e,i)),n=i}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let i=this.cache.get(e);i||(i=new t.LineBasicMaterial,t.Material.prototype.copy.call(i,n),i.color.copy(n.color),this.cache.add(e,i)),n=i}if(o||s||r){let t="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),o&&(t+="derivative-tangents:"),s&&(t+="vertex-colors:"),r&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),s&&(e.vertexColors=!0),r&&(e.flatShading=!0),o&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}n.aoMap&&void 0===i.attributes.uv2&&void 0!==i.attributes.uv&&i.setAttribute("uv2",i.attributes.uv),e.material=n}getMaterialType(){return t.MeshStandardMaterial}loadMaterial(e){const i=this,n=this.json,o=this.extensions,s=n.materials[e];let r;const a={},c=s.extensions||{},h=[];if(c[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=o[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=t.getMaterialType(),h.push(t.extendParams(a,s,i))}else if(c[v.KHR_MATERIALS_UNLIT]){const t=o[v.KHR_MATERIALS_UNLIT];r=t.getMaterialType(),h.push(t.extendParams(a,s,i))}else{const n=s.pbrMetallicRoughness||{};if(a.color=new t.Color(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;a.color.fromArray(t),a.opacity=t[3]}void 0!==n.baseColorTexture&&h.push(i.assignTexture(a,"map",n.baseColorTexture,t.sRGBEncoding)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(h.push(i.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),h.push(i.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),r=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),h.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===s.doubleSided&&(a.side=t.DoubleSide);const l=s.alphaMode||"OPAQUE";if("BLEND"===l?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===l&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&r!==t.MeshBasicMaterial&&(h.push(i.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new t.Vector2(1,1),void 0!==s.normalTexture.scale)){const t=s.normalTexture.scale;a.normalScale.set(t,t)}return void 0!==s.occlusionTexture&&r!==t.MeshBasicMaterial&&(h.push(i.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&r!==t.MeshBasicMaterial&&(a.emissive=(new t.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&r!==t.MeshBasicMaterial&&h.push(i.assignTexture(a,"emissiveMap",s.emissiveTexture,t.sRGBEncoding)),Promise.all(h).then((function(){let t;return t=r===F?o[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new r(a),s.name&&(t.name=s.name),W(t,s),i.associations.set(t,{materials:e}),s.extensions&&Q(o,t,s),t}))}createUniqueName(e){const i=t.PropertyBinding.sanitizeNodeName(e||"");let n=i;for(let t=1;this.nodeNamesUsed[n];++t)n=i+"_"+t;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const i=this,n=this.extensions,o=this.primitiveCache;function s(t){return n[v.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,i).then((function(e){return ot(e,t,i)}))}const r=[];for(let n=0,a=e.length;n<a;n++){const a=e[n],c=$(a),h=o[c];if(h)r.push(h.promise);else{let e;e=a.extensions&&a.extensions[v.KHR_DRACO_MESH_COMPRESSION]?s(a):ot(new t.BufferGeometry,a,i),o[c]={primitive:a,promise:e},r.push(e)}}return Promise.all(r)}loadMesh(e){const i=this,n=this.json,o=this.extensions,s=n.meshes[e],r=s.primitives,a=[];for(let e=0,i=r.length;e<i;e++){const i=void 0===r[e].material?(void 0===(c=this.cache).DefaultMaterial&&(c.DefaultMaterial=new t.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:t.FrontSide})),c.DefaultMaterial):this.getDependency("material",r[e].material);a.push(i)}var c;return a.push(i.loadGeometries(r)),Promise.all(a).then((function(n){const a=n.slice(0,n.length-1),c=n[n.length-1],h=[];for(let n=0,l=c.length;n<l;n++){const l=c[n],u=r[n];let m;const p=a[n];if(u.mode===V.TRIANGLES||u.mode===V.TRIANGLE_STRIP||u.mode===V.TRIANGLE_FAN||void 0===u.mode)m=!0===s.isSkinnedMesh?new t.SkinnedMesh(l,p):new t.Mesh(l,p),!0!==m.isSkinnedMesh||m.geometry.attributes.skinWeight.normalized||m.normalizeSkinWeights(),u.mode===V.TRIANGLE_STRIP?m.geometry=st(m.geometry,t.TriangleStripDrawMode):u.mode===V.TRIANGLE_FAN&&(m.geometry=st(m.geometry,t.TriangleFanDrawMode));else if(u.mode===V.LINES)m=new t.LineSegments(l,p);else if(u.mode===V.LINE_STRIP)m=new t.Line(l,p);else if(u.mode===V.LINE_LOOP)m=new t.LineLoop(l,p);else{if(u.mode!==V.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);m=new t.Points(l,p)}Object.keys(m.geometry.morphAttributes).length>0&&J(m,s),m.name=i.createUniqueName(s.name||"mesh_"+e),W(m,s),u.extensions&&Q(o,m,u),i.assignFinalMaterial(m),h.push(m)}for(let t=0,n=h.length;t<n;t++)i.associations.set(h[t],{meshes:e,primitives:t});if(1===h.length)return h[0];const l=new t.Group;i.associations.set(l,{meshes:e});for(let t=0,e=h.length;t<e;t++)l.add(h[t]);return l}))}loadCamera(e){let i;const n=this.json.cameras[e],o=n[n.type];if(o)return"perspective"===n.type?i=new t.PerspectiveCamera(t.MathUtils.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):"orthographic"===n.type&&(i=new t.OrthographicCamera(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),n.name&&(i.name=this.createUniqueName(n.name)),W(i,n),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],i={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return i.inverseBindMatrices=t,i}))}loadAnimation(e){const i=this.json.animations[e],n=[],o=[],s=[],r=[],a=[];for(let t=0,e=i.channels.length;t<e;t++){const e=i.channels[t],c=i.samplers[e.sampler],h=e.target,l=h.node,u=void 0!==i.parameters?i.parameters[c.input]:c.input,m=void 0!==i.parameters?i.parameters[c.output]:c.output;n.push(this.getDependency("node",l)),o.push(this.getDependency("accessor",u)),s.push(this.getDependency("accessor",m)),r.push(c),a.push(h)}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(s),Promise.all(r),Promise.all(a)]).then((function(n){const o=n[0],s=n[1],r=n[2],a=n[3],c=n[4],h=[];for(let e=0,i=o.length;e<i;e++){const i=o[e],n=s[e],l=r[e],u=a[e],m=c[e];if(void 0===i)continue;let p;switch(i.updateMatrix(),K[m.path]){case K.weights:p=t.NumberKeyframeTrack;break;case K.rotation:p=t.QuaternionKeyframeTrack;break;default:p=t.VectorKeyframeTrack}const d=i.name?i.name:i.uuid,f=void 0!==u.interpolation?q[u.interpolation]:t.InterpolateLinear,y=[];K[m.path]===K.weights?i.traverse((function(t){t.morphTargetInfluences&&y.push(t.name?t.name:t.uuid)})):y.push(d);let v=l.array;if(l.normalized){const t=et(v.constructor),e=new Float32Array(v.length);for(let i=0,n=v.length;i<n;i++)e[i]=v[i]*t;v=e}for(let e=0,i=y.length;e<i;e++){const i=new p(y[e]+"."+K[m.path],n.array,v,f);"CUBICSPLINE"===u.interpolation&&(i.createInterpolant=function(e){return new(this instanceof t.QuaternionKeyframeTrack?U:j)(this.times,this.values,this.getValueSize()/3,e)},i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),h.push(i)}}const l=i.name?i.name:"animation_"+e;return new t.AnimationClip(l,void 0,h)}))}createNodeMesh(t){const e=this.json,i=this,n=e.nodes[t];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then((function(t){const e=i._getNodeRef(i.meshCache,n.mesh,t);return void 0!==n.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,i=n.weights.length;e<i;e++)t.morphTargetInfluences[e]=n.weights[e]})),e}))}loadNode(e){const i=this.json,n=this.extensions,o=this,s=i.nodes[e],r=s.name?o.createUniqueName(s.name):"";return function(){const t=[],i=o._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return i&&t.push(i),void 0!==s.camera&&t.push(o.getDependency("camera",s.camera).then((function(t){return o._getNodeRef(o.cameraCache,s.camera,t)}))),o._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(i){let a;if(a=!0===s.isBone?new t.Bone:i.length>1?new t.Group:1===i.length?i[0]:new t.Object3D,a!==i[0])for(let t=0,e=i.length;t<e;t++)a.add(i[t]);if(s.name&&(a.userData.name=s.name,a.name=r),W(a,s),s.extensions&&Q(n,a,s),void 0!==s.matrix){const e=new t.Matrix4;e.fromArray(s.matrix),a.applyMatrix4(e)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return o.associations.has(a)||o.associations.set(a,{}),o.associations.get(a).nodes=e,a}))}loadScene(e){const i=this.json,n=this.extensions,o=this.json.scenes[e],s=this,r=new t.Group;o.name&&(r.name=s.createUniqueName(o.name)),W(r,o),o.extensions&&Q(n,r,o);const a=o.nodes||[],c=[];for(let t=0,e=a.length;t<e;t++)c.push(nt(a[t],r,i,s));return Promise.all(c).then((function(){return s.associations=(e=>{const i=new Map;for(const[e,n]of s.associations)(e instanceof t.Material||e instanceof t.Texture)&&i.set(e,n);return e.traverse((t=>{const e=s.associations.get(t);null!=e&&i.set(t,e)})),i})(r),r}))}}function nt(e,i,n,o){const s=n.nodes[e];return o.getDependency("node",e).then((function(e){if(void 0===s.skin)return e;let i;return o.getDependency("skin",s.skin).then((function(t){i=t;const e=[];for(let t=0,n=i.joints.length;t<n;t++)e.push(o.getDependency("node",i.joints[t]));return Promise.all(e)})).then((function(n){return e.traverse((function(e){if(!e.isMesh)return;const o=[],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];if(r){o.push(r);const n=new t.Matrix4;void 0!==i.inverseBindMatrices&&n.fromArray(i.inverseBindMatrices.array,16*e),s.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[e])}e.bind(new t.Skeleton(o,s),e.matrixWorld)})),e}))})).then((function(t){i.add(t);const e=[];if(s.children){const i=s.children;for(let s=0,r=i.length;s<r;s++){const r=i[s];e.push(nt(r,t,n,o))}}return Promise.all(e)}))}function ot(e,i,n){const o=i.attributes,s=[];function r(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in o){const i=Z[t]||t.toLowerCase();i in e.attributes||s.push(r(o[t],i))}if(void 0!==i.indices&&!e.index){const t=n.getDependency("accessor",i.indices).then((function(t){e.setIndex(t)}));s.push(t)}return W(e,i),function(e,i,n){const o=i.attributes,s=new t.Box3;if(void 0===o.POSITION)return;{const e=n.json.accessors[o.POSITION],i=e.min,r=e.max;if(void 0===i||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new t.Vector3(i[0],i[1],i[2]),new t.Vector3(r[0],r[1],r[2])),e.normalized){const t=et(H[e.componentType]);s.min.multiplyScalar(t),s.max.multiplyScalar(t)}}const r=i.targets;if(void 0!==r){const e=new t.Vector3,i=new t.Vector3;for(let t=0,o=r.length;t<o;t++){const o=r[t];if(void 0!==o.POSITION){const t=n.json.accessors[o.POSITION],s=t.min,r=t.max;if(void 0!==s&&void 0!==r){if(i.setX(Math.max(Math.abs(s[0]),Math.abs(r[0]))),i.setY(Math.max(Math.abs(s[1]),Math.abs(r[1]))),i.setZ(Math.max(Math.abs(s[2]),Math.abs(r[2]))),t.normalized){const e=et(H[t.componentType]);i.multiplyScalar(e)}e.max(i)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(e)}e.boundingBox=s;const a=new t.Sphere;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=a}(e,i,n),Promise.all(s).then((function(){return void 0!==i.targets?function(t,e,i){let n=!1,o=!1,s=!1;for(let t=0,i=e.length;t<i;t++){const i=e[t];if(void 0!==i.POSITION&&(n=!0),void 0!==i.NORMAL&&(o=!0),void 0!==i.COLOR_0&&(s=!0),n&&o&&s)break}if(!n&&!o&&!s)return Promise.resolve(t);const r=[],a=[],c=[];for(let h=0,l=e.length;h<l;h++){const l=e[h];if(n){const e=void 0!==l.POSITION?i.getDependency("accessor",l.POSITION):t.attributes.position;r.push(e)}if(o){const e=void 0!==l.NORMAL?i.getDependency("accessor",l.NORMAL):t.attributes.normal;a.push(e)}if(s){const e=void 0!==l.COLOR_0?i.getDependency("accessor",l.COLOR_0):t.attributes.color;c.push(e)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c)]).then((function(e){const i=e[0],r=e[1],a=e[2];return n&&(t.morphAttributes.position=i),o&&(t.morphAttributes.normal=r),s&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(e,i.targets,n):e}))}function st(e,i){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const o=n.count-2,s=[];if(i===t.TriangleFanDrawMode)for(let t=1;t<=o;t++)s.push(n.getX(0)),s.push(n.getX(t)),s.push(n.getX(t+1));else for(let t=0;t<o;t++)t%2==0?(s.push(n.getX(t)),s.push(n.getX(t+1)),s.push(n.getX(t+2))):(s.push(n.getX(t+2)),s.push(n.getX(t+1)),s.push(n.getX(t)));s.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=e.clone();return r.setIndex(s),r}const rt={type:"change"},at={type:"start"},ct={type:"end"};class ht extends t.EventDispatcher{constructor(e,i){super(),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.touches={ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",X),this._domElementKeyEvents=t},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(rt),n.update(),s=o.NONE},this.update=function(){const i=new t.Vector3,m=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),p=m.clone().invert(),d=new t.Vector3,f=new t.Quaternion,y=2*Math.PI;return function(){const t=n.object.position;i.copy(t).sub(n.target),i.applyQuaternion(m),a.setFromVector3(i),n.autoRotate&&s===o.NONE&&E(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(a.theta+=c.theta*n.dampingFactor,a.phi+=c.phi*n.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let e=n.minAzimuthAngle,v=n.maxAzimuthAngle;return isFinite(e)&&isFinite(v)&&(e<-Math.PI?e+=y:e>Math.PI&&(e-=y),v<-Math.PI?v+=y:v>Math.PI&&(v-=y),a.theta=e<=v?Math.max(e,Math.min(v,a.theta)):a.theta>(e+v)/2?Math.max(e,a.theta):Math.min(v,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=h,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),!0===n.enableDamping?n.target.addScaledVector(l,n.dampingFactor):n.target.add(l),i.setFromSpherical(a),i.applyQuaternion(p),t.copy(n.target).add(i),n.object.lookAt(n.target),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,l.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),l.set(0,0,0)),h=1,!!(u||d.distanceToSquared(n.object.position)>r||8*(1-f.dot(n.object.quaternion))>r)&&(n.dispatchEvent(rt),d.copy(n.object.position),f.copy(n.object.quaternion),u=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Y),n.domElement.removeEventListener("pointerdown",j),n.domElement.removeEventListener("pointercancel",V),n.domElement.removeEventListener("wheel",H),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",U),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",X)};const n=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const r=1e-6,a=new t.Spherical,c=new t.Spherical;let h=1;const l=new t.Vector3;let u=!1;const m=new t.Vector2,p=new t.Vector2,d=new t.Vector2,f=new t.Vector2,y=new t.Vector2,v=new t.Vector2,_=new t.Vector2,g=new t.Vector2,w=new t.Vector2,b=[],M={};function x(){return Math.pow(.95,n.zoomSpeed)}function E(t){c.theta-=t}function S(t){c.phi-=t}const T=function(){const e=new t.Vector3;return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),l.add(e)}}(),A=function(){const e=new t.Vector3;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),l.add(e)}}(),P=function(){const e=new t.Vector3;return function(t,i){const o=n.domElement;if(n.object.isPerspectiveCamera){const s=n.object.position;e.copy(s).sub(n.target);let r=e.length();r*=Math.tan(n.object.fov/2*Math.PI/180),T(2*t*r/o.clientHeight,n.object.matrix),A(2*i*r/o.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(T(t*(n.object.right-n.object.left)/n.object.zoom/o.clientWidth,n.object.matrix),A(i*(n.object.top-n.object.bottom)/n.object.zoom/o.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function R(t){n.object.isPerspectiveCamera?h/=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*t)),n.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function L(t){n.object.isPerspectiveCamera?h*=t:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/t)),n.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function C(t){m.set(t.clientX,t.clientY)}function O(t){f.set(t.clientX,t.clientY)}function I(){if(1===b.length)m.set(b[0].pageX,b[0].pageY);else{const t=.5*(b[0].pageX+b[1].pageX),e=.5*(b[0].pageY+b[1].pageY);m.set(t,e)}}function k(){if(1===b.length)f.set(b[0].pageX,b[0].pageY);else{const t=.5*(b[0].pageX+b[1].pageX),e=.5*(b[0].pageY+b[1].pageY);f.set(t,e)}}function N(){const t=b[0].pageX-b[1].pageX,e=b[0].pageY-b[1].pageY,i=Math.sqrt(t*t+e*e);_.set(0,i)}function F(t){if(1==b.length)p.set(t.pageX,t.pageY);else{const e=K(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);p.set(i,n)}d.subVectors(p,m).multiplyScalar(n.rotateSpeed);const e=n.domElement;E(2*Math.PI*d.x/e.clientHeight),S(2*Math.PI*d.y/e.clientHeight),m.copy(p)}function z(t){if(1===b.length)y.set(t.pageX,t.pageY);else{const e=K(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);y.set(i,n)}v.subVectors(y,f).multiplyScalar(n.panSpeed),P(v.x,v.y),f.copy(y)}function D(t){const e=K(t),i=t.pageX-e.x,o=t.pageY-e.y,s=Math.sqrt(i*i+o*o);g.set(0,s),w.set(0,Math.pow(g.y/_.y,n.zoomSpeed)),R(w.y),_.copy(g)}function j(e){!1!==n.enabled&&(0===b.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",G),n.domElement.addEventListener("pointerup",U)),function(t){b.push(t)}(e),"touch"===e.pointerType?function(e){switch(Z(e),b.length){case 1:switch(n.touches.ONE){case t.TOUCH.ROTATE:if(!1===n.enableRotate)return;I(),s=o.TOUCH_ROTATE;break;case t.TOUCH.PAN:if(!1===n.enablePan)return;k(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(n.touches.TWO){case t.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&N(),n.enablePan&&k(),s=o.TOUCH_DOLLY_PAN;break;case t.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&N(),n.enableRotate&&I(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(at)}(e):function(e){let i;switch(e.button){case 0:i=n.mouseButtons.LEFT;break;case 1:i=n.mouseButtons.MIDDLE;break;case 2:i=n.mouseButtons.RIGHT;break;default:i=-1}switch(i){case t.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(t){_.set(t.clientX,t.clientY)}(e),s=o.DOLLY;break;case t.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;O(e),s=o.PAN}else{if(!1===n.enableRotate)return;C(e),s=o.ROTATE}break;case t.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;C(e),s=o.ROTATE}else{if(!1===n.enablePan)return;O(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(at)}(e))}function G(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch(Z(t),s){case o.TOUCH_ROTATE:if(!1===n.enableRotate)return;F(t),n.update();break;case o.TOUCH_PAN:if(!1===n.enablePan)return;z(t),n.update();break;case o.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(t){n.enableZoom&&D(t),n.enablePan&&z(t)}(t),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(t){n.enableZoom&&D(t),n.enableRotate&&F(t)}(t),n.update();break;default:s=o.NONE}}(t):function(t){switch(s){case o.ROTATE:if(!1===n.enableRotate)return;!function(t){p.set(t.clientX,t.clientY),d.subVectors(p,m).multiplyScalar(n.rotateSpeed);const e=n.domElement;E(2*Math.PI*d.x/e.clientHeight),S(2*Math.PI*d.y/e.clientHeight),m.copy(p),n.update()}(t);break;case o.DOLLY:if(!1===n.enableZoom)return;!function(t){g.set(t.clientX,t.clientY),w.subVectors(g,_),w.y>0?R(x()):w.y<0&&L(x()),_.copy(g),n.update()}(t);break;case o.PAN:if(!1===n.enablePan)return;!function(t){y.set(t.clientX,t.clientY),v.subVectors(y,f).multiplyScalar(n.panSpeed),P(v.x,v.y),f.copy(y),n.update()}(t)}}(t))}function U(t){B(t),0===b.length&&(n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",G),n.domElement.removeEventListener("pointerup",U)),n.dispatchEvent(ct),s=o.NONE}function V(t){B(t)}function H(t){!1!==n.enabled&&!1!==n.enableZoom&&s===o.NONE&&(t.preventDefault(),n.dispatchEvent(at),function(t){t.deltaY<0?L(x()):t.deltaY>0&&R(x()),n.update()}(t),n.dispatchEvent(ct))}function X(t){!1!==n.enabled&&!1!==n.enablePan&&function(t){let e=!1;switch(t.code){case n.keys.UP:P(0,n.keyPanSpeed),e=!0;break;case n.keys.BOTTOM:P(0,-n.keyPanSpeed),e=!0;break;case n.keys.LEFT:P(n.keyPanSpeed,0),e=!0;break;case n.keys.RIGHT:P(-n.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),n.update())}(t)}function Y(t){!1!==n.enabled&&t.preventDefault()}function B(t){delete M[t.pointerId];for(let e=0;e<b.length;e++)if(b[e].pointerId==t.pointerId)return void b.splice(e,1)}function Z(e){let i=M[e.pointerId];void 0===i&&(i=new t.Vector2,M[e.pointerId]=i),i.set(e.pageX,e.pageY)}function K(t){const e=t.pointerId===b[0].pointerId?b[1]:b[0];return M[e.pointerId]}n.domElement.addEventListener("contextmenu",Y),n.domElement.addEventListener("pointerdown",j),n.domElement.addEventListener("pointercancel",V),n.domElement.addEventListener("wheel",H,{passive:!1}),this.update()}}const lt=new t.Plane,ut=new t.Raycaster,mt=new t.Vector2,pt=new t.Vector3,dt=new t.Vector3,ft=new t.Vector3,yt=new t.Matrix4;class vt extends t.EventDispatcher{constructor(t,e,i){super(),i.style.touchAction="none";let n=null,o=null;const s=[],r=this;function a(){i.addEventListener("pointermove",h),i.addEventListener("pointerdown",l),i.addEventListener("pointerup",u),i.addEventListener("pointerleave",u)}function c(){i.removeEventListener("pointermove",h),i.removeEventListener("pointerdown",l),i.removeEventListener("pointerup",u),i.removeEventListener("pointerleave",u),i.style.cursor=""}function h(a){if(!1!==r.enabled){if(m(a),ut.setFromCamera(mt,e),n)return ut.ray.intersectPlane(lt,dt)&&n.position.copy(dt.sub(pt).applyMatrix4(yt)),void r.dispatchEvent({type:"drag",object:n});if("mouse"===a.pointerType||"pen"===a.pointerType)if(s.length=0,ut.setFromCamera(mt,e),ut.intersectObjects(t,!0,s),s.length>0){const t=s[0].object;lt.setFromNormalAndCoplanarPoint(e.getWorldDirection(lt.normal),ft.setFromMatrixPosition(t.matrixWorld)),o!==t&&null!==o&&(r.dispatchEvent({type:"hoveroff",object:o}),i.style.cursor="auto",o=null),o!==t&&(r.dispatchEvent({type:"hoveron",object:t}),i.style.cursor="pointer",o=t)}else null!==o&&(r.dispatchEvent({type:"hoveroff",object:o}),i.style.cursor="auto",o=null)}}function l(o){!1!==r.enabled&&(m(o),s.length=0,ut.setFromCamera(mt,e),ut.intersectObjects(t,!0,s),s.length>0&&(n=!0===r.transformGroup?t[0]:s[0].object,lt.setFromNormalAndCoplanarPoint(e.getWorldDirection(lt.normal),ft.setFromMatrixPosition(n.matrixWorld)),ut.ray.intersectPlane(lt,dt)&&(yt.copy(n.parent.matrixWorld).invert(),pt.copy(dt).sub(ft.setFromMatrixPosition(n.matrixWorld))),i.style.cursor="move",r.dispatchEvent({type:"dragstart",object:n})))}function u(){!1!==r.enabled&&(n&&(r.dispatchEvent({type:"dragend",object:n}),n=null),i.style.cursor=o?"pointer":"auto")}function m(t){const e=i.getBoundingClientRect();mt.x=(t.clientX-e.left)/e.width*2-1,mt.y=-(t.clientY-e.top)/e.height*2+1}a(),this.enabled=!0,this.transformGroup=!1,this.activate=a,this.deactivate=c,this.dispose=function(){c()},this.getObjects=function(){return t},this.getRaycaster=function(){return ut}}}const _t=new t.Vector3,gt=new t.Spherical,wt=new t.Vector3;function bt(t){t.preventDefault()}const Mt={type:"change"};class xt extends t.EventDispatcher{constructor(e,i){super(),this.object=e,this.domElement=i,this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1;const n=this,o=1e-6,s=new t.Quaternion,r=new t.Vector3;this.tmpQuaternion=new t.Quaternion,this.status=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=new t.Vector3(0,0,0),this.rotationVector=new t.Vector3(0,0,0),this.keydown=function(t){if(!t.altKey){switch(t.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(t){switch(t.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.pointerdown=function(t){if(this.dragToLook)this.status++;else{switch(t.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},this.pointermove=function(t){if(!this.dragToLook||this.status>0){const e=this.getContainerDimensions(),i=e.size[0]/2,n=e.size[1]/2;this.moveState.yawLeft=-(t.pageX-e.offset[0]-i)/i,this.moveState.pitchDown=(t.pageY-e.offset[1]-n)/n,this.updateRotationVector()}},this.pointerup=function(t){if(this.dragToLook)this.status--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(t.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},this.update=function(t){const e=t*n.movementSpeed,i=t*n.rollSpeed;n.object.translateX(n.moveVector.x*e),n.object.translateY(n.moveVector.y*e),n.object.translateZ(n.moveVector.z*e),n.tmpQuaternion.set(n.rotationVector.x*i,n.rotationVector.y*i,n.rotationVector.z*i,1).normalize(),n.object.quaternion.multiply(n.tmpQuaternion),(r.distanceToSquared(n.object.position)>o||8*(1-s.dot(n.object.quaternion))>o)&&(n.dispatchEvent(Mt),s.copy(n.object.quaternion),r.copy(n.object.position))},this.updateMovementVector=function(){const t=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-t+this.moveState.back},this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",Et),this.domElement.removeEventListener("pointerdown",c),this.domElement.removeEventListener("pointermove",a),this.domElement.removeEventListener("pointerup",h),window.removeEventListener("keydown",l),window.removeEventListener("keyup",u)};const a=this.pointermove.bind(this),c=this.pointerdown.bind(this),h=this.pointerup.bind(this),l=this.keydown.bind(this),u=this.keyup.bind(this);this.domElement.addEventListener("contextmenu",Et),this.domElement.addEventListener("pointerdown",c),this.domElement.addEventListener("pointermove",a),this.domElement.addEventListener("pointerup",h),window.addEventListener("keydown",l),window.addEventListener("keyup",u),this.updateMovementVector(),this.updateRotationVector()}}function Et(t){t.preventDefault()}const St=new t.Euler(0,0,0,"YXZ"),Tt=new t.Vector3,At={type:"change"},Pt={type:"lock"},Rt={type:"unlock"},Lt=Math.PI/2;class Ct extends t.EventDispatcher{constructor(e,i){super(),this.domElement=i,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1;const n=this;function o(t){if(!1===n.isLocked)return;const i=t.movementX||t.mozMovementX||t.webkitMovementX||0,o=t.movementY||t.mozMovementY||t.webkitMovementY||0;St.setFromQuaternion(e.quaternion),St.y-=.002*i*n.pointerSpeed,St.x-=.002*o*n.pointerSpeed,St.x=Math.max(Lt-n.maxPolarAngle,Math.min(Lt-n.minPolarAngle,St.x)),e.quaternion.setFromEuler(St),n.dispatchEvent(At)}function s(){n.domElement.ownerDocument.pointerLockElement===n.domElement?(n.dispatchEvent(Pt),n.isLocked=!0):(n.dispatchEvent(Rt),n.isLocked=!1)}function r(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}this.connect=function(){n.domElement.ownerDocument.addEventListener("mousemove",o),n.domElement.ownerDocument.addEventListener("pointerlockchange",s),n.domElement.ownerDocument.addEventListener("pointerlockerror",r)},this.disconnect=function(){n.domElement.ownerDocument.removeEventListener("mousemove",o),n.domElement.ownerDocument.removeEventListener("pointerlockchange",s),n.domElement.ownerDocument.removeEventListener("pointerlockerror",r)},this.dispose=function(){this.disconnect()},this.getObject=function(){return e},this.getDirection=function(){const i=new t.Vector3(0,0,-1);return function(t){return t.copy(i).applyQuaternion(e.quaternion)}}(),this.moveForward=function(t){Tt.setFromMatrixColumn(e.matrix,0),Tt.crossVectors(e.up,Tt),e.position.addScaledVector(Tt,t)},this.moveRight=function(t){Tt.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(Tt,t)},this.lock=function(){this.domElement.requestPointerLock()},this.unlock=function(){n.domElement.ownerDocument.exitPointerLock()},this.connect()}}const Ot={type:"change"},It={type:"start"},kt={type:"end"};class Nt extends t.EventDispatcher{constructor(e,i){super();const n=this,o={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.target=new t.Vector3;const s=1e-6,r=new t.Vector3;let a=1,c=o.NONE,h=o.NONE,l=0,u=0,m=0;const p=new t.Vector3,d=new t.Vector2,f=new t.Vector2,y=new t.Vector3,v=new t.Vector2,_=new t.Vector2,g=new t.Vector2,w=new t.Vector2,b=[],M={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const t=n.domElement.getBoundingClientRect(),e=n.domElement.ownerDocument.documentElement;n.screen.left=t.left+window.pageXOffset-e.clientLeft,n.screen.top=t.top+window.pageYOffset-e.clientTop,n.screen.width=t.width,n.screen.height=t.height};const x=function(){const e=new t.Vector2;return function(t,i){return e.set((t-n.screen.left)/n.screen.width,(i-n.screen.top)/n.screen.height),e}}(),E=function(){const e=new t.Vector2;return function(t,i){return e.set((t-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(n.screen.height+2*(n.screen.top-i))/n.screen.width),e}}();function S(t){!1!==n.enabled&&(0===b.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",T),n.domElement.addEventListener("pointerup",A)),function(t){b.push(t)}(t),"touch"===t.pointerType?function(t){if(1===(k(t),b.length))c=o.TOUCH_ROTATE,f.copy(E(b[0].pageX,b[0].pageY)),d.copy(f);else{c=o.TOUCH_ZOOM_PAN;const t=b[0].pageX-b[1].pageX,e=b[0].pageY-b[1].pageY;u=l=Math.sqrt(t*t+e*e);const i=(b[0].pageX+b[1].pageX)/2,n=(b[0].pageY+b[1].pageY)/2;g.copy(x(i,n)),w.copy(g)}n.dispatchEvent(It)}(t):function(t){if(c===o.NONE)switch(t.button){case n.mouseButtons.LEFT:c=o.ROTATE;break;case n.mouseButtons.MIDDLE:c=o.ZOOM;break;case n.mouseButtons.RIGHT:c=o.PAN}const e=h!==o.NONE?h:c;e!==o.ROTATE||n.noRotate?e!==o.ZOOM||n.noZoom?e!==o.PAN||n.noPan||(g.copy(x(t.pageX,t.pageY)),w.copy(g)):(v.copy(x(t.pageX,t.pageY)),_.copy(v)):(f.copy(E(t.pageX,t.pageY)),d.copy(f)),n.dispatchEvent(It)}(t))}function T(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){if(1===(k(t),b.length))d.copy(f),f.copy(E(t.pageX,t.pageY));else{const e=function(t){const e=t.pointerId===b[0].pointerId?b[1]:b[0];return M[e.pointerId]}(t),i=t.pageX-e.x,n=t.pageY-e.y;u=Math.sqrt(i*i+n*n);const o=(t.pageX+e.x)/2,s=(t.pageY+e.y)/2;w.copy(x(o,s))}}(t):function(t){const e=h!==o.NONE?h:c;e!==o.ROTATE||n.noRotate?e!==o.ZOOM||n.noZoom?e!==o.PAN||n.noPan||w.copy(x(t.pageX,t.pageY)):_.copy(x(t.pageX,t.pageY)):(d.copy(f),f.copy(E(t.pageX,t.pageY)))}(t))}function A(t){!1!==n.enabled&&("touch"===t.pointerType?function(t){switch(b.length){case 0:c=o.NONE;break;case 1:c=o.TOUCH_ROTATE,f.copy(E(t.pageX,t.pageY)),d.copy(f);break;case 2:c=o.TOUCH_ZOOM_PAN;for(let e=0;e<b.length;e++)if(b[e].pointerId!==t.pointerId){const t=M[b[e].pointerId];f.copy(E(t.x,t.y)),d.copy(f);break}}n.dispatchEvent(kt)}(t):(c=o.NONE,n.dispatchEvent(kt)),I(t),0===b.length&&(n.domElement.releasePointerCapture(t.pointerId),n.domElement.removeEventListener("pointermove",T),n.domElement.removeEventListener("pointerup",A)))}function P(t){I(t)}function R(t){!1!==n.enabled&&(window.removeEventListener("keydown",R),h===o.NONE&&(t.code!==n.keys[o.ROTATE]||n.noRotate?t.code!==n.keys[o.ZOOM]||n.noZoom?t.code!==n.keys[o.PAN]||n.noPan||(h=o.PAN):h=o.ZOOM:h=o.ROTATE))}function L(){!1!==n.enabled&&(h=o.NONE,window.addEventListener("keydown",R))}function C(t){if(!1!==n.enabled&&!0!==n.noZoom){switch(t.preventDefault(),t.deltaMode){case 2:v.y-=.025*t.deltaY;break;case 1:v.y-=.01*t.deltaY;break;default:v.y-=25e-5*t.deltaY}n.dispatchEvent(It),n.dispatchEvent(kt)}}function O(t){!1!==n.enabled&&t.preventDefault()}function I(t){delete M[t.pointerId];for(let e=0;e<b.length;e++)if(b[e].pointerId==t.pointerId)return void b.splice(e,1)}function k(e){let i=M[e.pointerId];void 0===i&&(i=new t.Vector2,M[e.pointerId]=i),i.set(e.pageX,e.pageY)}this.rotateCamera=function(){const e=new t.Vector3,i=new t.Quaternion,o=new t.Vector3,s=new t.Vector3,r=new t.Vector3,a=new t.Vector3;return function(){a.set(f.x-d.x,f.y-d.y,0);let t=a.length();t?(p.copy(n.object.position).sub(n.target),o.copy(p).normalize(),s.copy(n.object.up).normalize(),r.crossVectors(s,o).normalize(),s.setLength(f.y-d.y),r.setLength(f.x-d.x),a.copy(s.add(r)),e.crossVectors(a,p).normalize(),t*=n.rotateSpeed,i.setFromAxisAngle(e,t),p.applyQuaternion(i),n.object.up.applyQuaternion(i),y.copy(e),m=t):!n.staticMoving&&m&&(m*=Math.sqrt(1-n.dynamicDampingFactor),p.copy(n.object.position).sub(n.target),i.setFromAxisAngle(y,m),p.applyQuaternion(i),n.object.up.applyQuaternion(i)),d.copy(f)}}(),this.zoomCamera=function(){let t;c===o.TOUCH_ZOOM_PAN?(t=l/u,l=u,n.object.isPerspectiveCamera?p.multiplyScalar(t):n.object.isOrthographicCamera?(n.object.zoom/=t,n.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(t=1+(_.y-v.y)*n.zoomSpeed,1!==t&&t>0&&(n.object.isPerspectiveCamera?p.multiplyScalar(t):n.object.isOrthographicCamera?(n.object.zoom/=t,n.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),n.staticMoving?v.copy(_):v.y+=(_.y-v.y)*this.dynamicDampingFactor)},this.panCamera=function(){const e=new t.Vector2,i=new t.Vector3,o=new t.Vector3;return function(){if(e.copy(w).sub(g),e.lengthSq()){if(n.object.isOrthographicCamera){const t=(n.object.right-n.object.left)/n.object.zoom/n.domElement.clientWidth,i=(n.object.top-n.object.bottom)/n.object.zoom/n.domElement.clientWidth;e.x*=t,e.y*=i}e.multiplyScalar(p.length()*n.panSpeed),o.copy(p).cross(n.object.up).setLength(e.x),o.add(i.copy(n.object.up).setLength(e.y)),n.object.position.add(o),n.target.add(o),n.staticMoving?g.copy(w):g.add(e.subVectors(w,g).multiplyScalar(n.dynamicDampingFactor))}}}(),this.checkDistances=function(){n.noZoom&&n.noPan||(p.lengthSq()>n.maxDistance*n.maxDistance&&(n.object.position.addVectors(n.target,p.setLength(n.maxDistance)),v.copy(_)),p.lengthSq()<n.minDistance*n.minDistance&&(n.object.position.addVectors(n.target,p.setLength(n.minDistance)),v.copy(_)))},this.update=function(){p.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,p),n.object.isPerspectiveCamera?(n.checkDistances(),n.object.lookAt(n.target),r.distanceToSquared(n.object.position)>s&&(n.dispatchEvent(Ot),r.copy(n.object.position))):n.object.isOrthographicCamera?(n.object.lookAt(n.target),(r.distanceToSquared(n.object.position)>s||a!==n.object.zoom)&&(n.dispatchEvent(Ot),r.copy(n.object.position),a=n.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){c=o.NONE,h=o.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),p.subVectors(n.object.position,n.target),n.object.lookAt(n.target),n.dispatchEvent(Ot),r.copy(n.object.position),a=n.object.zoom},this.dispose=function(){n.domElement.removeEventListener("contextmenu",O),n.domElement.removeEventListener("pointerdown",S),n.domElement.removeEventListener("pointercancel",P),n.domElement.removeEventListener("wheel",C),n.domElement.removeEventListener("pointermove",T),n.domElement.removeEventListener("pointerup",A),window.removeEventListener("keydown",R),window.removeEventListener("keyup",L)},this.domElement.addEventListener("contextmenu",O),this.domElement.addEventListener("pointerdown",S),this.domElement.addEventListener("pointercancel",P),this.domElement.addEventListener("wheel",C,{passive:!1}),window.addEventListener("keydown",R),window.addEventListener("keyup",L),this.handleResize(),this.update()}}const Ft=new t.Raycaster,zt=new t.Vector3,Dt=new t.Vector3,jt=new t.Quaternion,Gt={X:new t.Vector3(1,0,0),Y:new t.Vector3(0,1,0),Z:new t.Vector3(0,0,1)},Ut={type:"change"},Vt={type:"mouseDown"},Ht={type:"mouseUp",mode:null},Xt={type:"objectChange"};class Yt extends t.Object3D{constructor(e,i){super(),void 0===i&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const n=new me;this._gizmo=n,this.add(n);const o=new pe;this._plane=o,this.add(o);const s=this;function r(t,e){let i=e;Object.defineProperty(s,t,{get:function(){return void 0!==i?i:e},set:function(e){i!==e&&(i=e,o[t]=e,n[t]=e,s.dispatchEvent({type:t+"-changed",value:e}),s.dispatchEvent(Ut))}}),s[t]=e,o[t]=e,n[t]=e}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const a=new t.Vector3,c=new t.Vector3,h=new t.Quaternion,l=new t.Quaternion,u=new t.Vector3,m=new t.Quaternion,p=new t.Vector3,d=new t.Vector3,f=new t.Vector3,y=new t.Vector3;r("worldPosition",a),r("worldPositionStart",c),r("worldQuaternion",h),r("worldQuaternionStart",l),r("cameraPosition",u),r("cameraQuaternion",m),r("pointStart",p),r("pointEnd",d),r("rotationAxis",f),r("rotationAngle",0),r("eye",y),this._offset=new t.Vector3,this._startNorm=new t.Vector3,this._endNorm=new t.Vector3,this._cameraScale=new t.Vector3,this._parentPosition=new t.Vector3,this._parentQuaternion=new t.Quaternion,this._parentQuaternionInv=new t.Quaternion,this._parentScale=new t.Vector3,this._worldScaleStart=new t.Vector3,this._worldQuaternionInv=new t.Quaternion,this._worldScale=new t.Vector3,this._positionStart=new t.Vector3,this._quaternionStart=new t.Quaternion,this._scaleStart=new t.Vector3,this._getPointer=Bt.bind(this),this._onPointerDown=Kt.bind(this),this._onPointerHover=Zt.bind(this),this._onPointerMove=qt.bind(this),this._onPointerUp=Qt.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(t){if(void 0===this.object||!0===this.dragging)return;Ft.setFromCamera(t,this.camera);const e=Wt(this._gizmo.picker[this.mode],Ft);this.axis=e?e.object.name:null}pointerDown(t){if(void 0!==this.object&&!0!==this.dragging&&0===t.button&&null!==this.axis){Ft.setFromCamera(t,this.camera);const e=Wt(this._plane,Ft,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,Vt.mode=this.mode,this.dispatchEvent(Vt)}}pointerMove(t){const e=this.axis,i=this.mode,n=this.object;let o=this.space;if("scale"===i?o="local":"E"!==e&&"XYZE"!==e&&"XYZ"!==e||(o="world"),void 0===n||null===e||!1===this.dragging||-1!==t.button)return;Ft.setFromCamera(t,this.camera);const s=Wt(this._plane,Ft,!0);if(s){if(this.pointEnd.copy(s.point).sub(this.worldPositionStart),"translate"===i)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===o&&"XYZ"!==e&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===e.indexOf("X")&&(this._offset.x=0),-1===e.indexOf("Y")&&(this._offset.y=0),-1===e.indexOf("Z")&&(this._offset.z=0),"local"===o&&"XYZ"!==e?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===o&&(n.position.applyQuaternion(jt.copy(this._quaternionStart).invert()),-1!==e.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==e.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==e.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),"world"===o&&(n.parent&&n.position.add(zt.setFromMatrixPosition(n.parent.matrixWorld)),-1!==e.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==e.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==e.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(zt.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===i){if(-1!==e.search("XYZ")){let t=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(t*=-1),Dt.set(t,t,t)}else zt.copy(this.pointStart),Dt.copy(this.pointEnd),zt.applyQuaternion(this._worldQuaternionInv),Dt.applyQuaternion(this._worldQuaternionInv),Dt.divide(zt),-1===e.search("X")&&(Dt.x=1),-1===e.search("Y")&&(Dt.y=1),-1===e.search("Z")&&(Dt.z=1);n.scale.copy(this._scaleStart).multiply(Dt),this.scaleSnap&&(-1!==e.search("X")&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==e.search("Y")&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==e.search("Z")&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===i){this._offset.copy(this.pointEnd).sub(this.pointStart);const t=20/this.worldPosition.distanceTo(zt.setFromMatrixPosition(this.camera.matrixWorld));"E"===e?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===e?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(zt.copy(this.rotationAxis).cross(this.eye))*t):"X"!==e&&"Y"!==e&&"Z"!==e||(this.rotationAxis.copy(Gt[e]),zt.copy(Gt[e]),"local"===o&&zt.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(zt.cross(this.eye).normalize())*t),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===o&&"E"!==e&&"XYZE"!==e?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(jt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(jt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Ut),this.dispatchEvent(Xt)}}pointerUp(t){0===t.button&&(this.dragging&&null!==this.axis&&(Ht.mode=this.mode,this.dispatchEvent(Ht)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()}))}attach(t){return this.object=t,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Ut),this.dispatchEvent(Xt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Ft}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function Bt(t){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:t.button};{const e=this.domElement.getBoundingClientRect();return{x:(t.clientX-e.left)/e.width*2-1,y:-(t.clientY-e.top)/e.height*2+1,button:t.button}}}function Zt(t){if(this.enabled)switch(t.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(t))}}function Kt(t){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(t)),this.pointerDown(this._getPointer(t)))}function qt(t){this.enabled&&this.pointerMove(this._getPointer(t))}function Qt(t){this.enabled&&(this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(t)))}function Wt(t,e,i){const n=e.intersectObject(t,!0);for(let t=0;t<n.length;t++)if(n[t].object.visible||i)return n[t];return!1}const Jt=new t.Euler,$t=new t.Vector3(0,1,0),te=new t.Vector3(0,0,0),ee=new t.Matrix4,ie=new t.Quaternion,ne=new t.Quaternion,oe=new t.Vector3,se=new t.Matrix4,re=new t.Vector3(1,0,0),ae=new t.Vector3(0,1,0),ce=new t.Vector3(0,0,1),he=new t.Vector3,le=new t.Vector3,ue=new t.Vector3;class me extends t.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new t.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new t.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const o=i.clone();o.opacity=.5;const s=e.clone();s.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const a=e.clone();a.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const h=e.clone();h.color.setHex(65280),h.opacity=.5;const l=e.clone();l.color.setHex(255),l.opacity=.5;const u=e.clone();u.opacity=.25;const m=e.clone();m.color.setHex(16776960),m.opacity=.25,e.clone().color.setHex(16776960);const p=e.clone();p.color.setHex(7895160);const d=new t.CylinderGeometry(0,.04,.1,12);d.translate(0,.05,0);const f=new t.BoxGeometry(.08,.08,.08);f.translate(0,.04,0);const y=new t.BufferGeometry;y.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,0,0],3));const v=new t.CylinderGeometry(.0075,.0075,.5,3);function _(e,i){const n=new t.TorusGeometry(e,.0075,3,64,i*Math.PI*2);return n.rotateY(Math.PI/2),n.rotateX(Math.PI/2),n}v.translate(0,.25,0);const g={X:[[new t.Mesh(d,s),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(d,s),[-.5,0,0],[0,0,Math.PI/2]],[new t.Mesh(v,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new t.Mesh(d,r),[0,.5,0]],[new t.Mesh(d,r),[0,-.5,0],[Math.PI,0,0]],[new t.Mesh(v,r)]],Z:[[new t.Mesh(d,a),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(d,a),[0,0,-.5],[-Math.PI/2,0,0]],[new t.Mesh(v,a),null,[Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.1,0),u.clone()),[0,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),l.clone()),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},w={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.OctahedronGeometry(.2,0),n)]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},b={START:[[new t.Mesh(new t.OctahedronGeometry(.01,2),o),null,null,null,"helper"]],END:[[new t.Mesh(new t.OctahedronGeometry(.01,2),o),null,null,null,"helper"]],DELTA:[[new t.Line(function(){const e=new t.BufferGeometry;return e.setAttribute("position",new t.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),o),null,null,null,"helper"]],X:[[new t.Line(y,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(y,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(y,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new t.Mesh(_(.5,1),p),null,[0,Math.PI/2,0]]],X:[[new t.Mesh(_(.5,.5),s)]],Y:[[new t.Mesh(_(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new t.Mesh(_(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new t.Mesh(_(.75,1),m),null,[0,Math.PI/2,0]]]},x={AXIS:[[new t.Line(y,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},E={XYZE:[[new t.Mesh(new t.SphereGeometry(.25,10,8),n)]],X:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new t.Mesh(new t.TorusGeometry(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new t.Mesh(new t.TorusGeometry(.75,.1,2,24),n)]]},S={X:[[new t.Mesh(f,s),[.5,0,0],[0,0,-Math.PI/2]],[new t.Mesh(v,s),[0,0,0],[0,0,-Math.PI/2]],[new t.Mesh(f,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(f,r),[0,.5,0]],[new t.Mesh(v,r)],[new t.Mesh(f,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new t.Mesh(f,a),[0,0,.5],[Math.PI/2,0,0]],[new t.Mesh(v,a),[0,0,0],[Math.PI/2,0,0]],[new t.Mesh(f,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),l),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.15,.15,.01),h),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.1,.1,.1),u.clone())]]},T={X:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,.3,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new t.Mesh(new t.CylinderGeometry(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new t.Mesh(new t.BoxGeometry(.2,.2,.2),n),[0,0,0]]]},A={X:[[new t.Line(y,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new t.Line(y,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new t.Line(y,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function P(e){const i=new t.Object3D;for(const t in e)for(let n=e[t].length;n--;){const o=e[t][n][0].clone(),s=e[t][n][1],r=e[t][n][2],a=e[t][n][3],c=e[t][n][4];o.name=t,o.tag=c,s&&o.position.set(s[0],s[1],s[2]),r&&o.rotation.set(r[0],r[1],r[2]),a&&o.scale.set(a[0],a[1],a[2]),o.updateMatrix();const h=o.geometry.clone();h.applyMatrix4(o.matrix),o.geometry=h,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),i.add(o)}return i}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=P(g)),this.add(this.gizmo.rotate=P(M)),this.add(this.gizmo.scale=P(S)),this.add(this.picker.translate=P(w)),this.add(this.picker.rotate=P(E)),this.add(this.picker.scale=P(T)),this.add(this.helper.translate=P(b)),this.add(this.helper.rotate=P(x)),this.add(this.helper.scale=P(A)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:ne;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let t=0;t<i.length;t++){const n=i[t];let o;if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition),o=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(o*this.size/4),"helper"!==n.tag){if(n.quaternion.copy(e),"translate"===this.mode||"scale"===this.mode){const t=.99,i=.2;"X"===n.name&&Math.abs($t.copy(re).applyQuaternion(e).dot(this.eye))>t&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"===n.name&&Math.abs($t.copy(ae).applyQuaternion(e).dot(this.eye))>t&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"===n.name&&Math.abs($t.copy(ce).applyQuaternion(e).dot(this.eye))>t&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs($t.copy(ce).applyQuaternion(e).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs($t.copy(re).applyQuaternion(e).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs($t.copy(ae).applyQuaternion(e).dot(this.eye))<i&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)}else"rotate"===this.mode&&(ie.copy(e),$t.copy(this.eye).applyQuaternion(jt.copy(e).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(ee.lookAt(this.eye,te,ae)),"X"===n.name&&(jt.setFromAxisAngle(re,Math.atan2(-$t.y,$t.z)),jt.multiplyQuaternions(ie,jt),n.quaternion.copy(jt)),"Y"===n.name&&(jt.setFromAxisAngle(ae,Math.atan2($t.x,$t.z)),jt.multiplyQuaternions(ie,jt),n.quaternion.copy(jt)),"Z"===n.name&&(jt.setFromAxisAngle(ce,Math.atan2($t.y,$t.x)),jt.multiplyQuaternions(ie,jt),n.quaternion.copy(jt)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some((function(t){return n.name===t})))&&(n.material.color.setHex(16776960),n.material.opacity=1)}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(jt.setFromEuler(Jt.set(0,0,0)),n.quaternion.copy(e).multiply(jt),Math.abs($t.copy(re).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(jt.setFromEuler(Jt.set(0,0,Math.PI/2)),n.quaternion.copy(e).multiply(jt),Math.abs($t.copy(ae).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(jt.setFromEuler(Jt.set(0,Math.PI/2,0)),n.quaternion.copy(e).multiply(jt),Math.abs($t.copy(ce).applyQuaternion(e).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(jt.setFromEuler(Jt.set(0,Math.PI/2,0)),$t.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(ee.lookAt(te,$t,ae)),n.quaternion.multiply(jt),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),zt.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),zt.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(zt),n.visible=this.dragging):(n.quaternion.copy(e),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}super.updateMatrixWorld(t)}}class pe extends t.Mesh{constructor(){super(new t.PlaneGeometry(1e5,1e5,2,2),new t.MeshBasicMaterial({visible:!1,wireframe:!0,side:t.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),he.copy(re).applyQuaternion("local"===e?this.worldQuaternion:ne),le.copy(ae).applyQuaternion("local"===e?this.worldQuaternion:ne),ue.copy(ce).applyQuaternion("local"===e?this.worldQuaternion:ne),$t.copy(le),this.mode){case"translate":case"scale":switch(this.axis){case"X":$t.copy(this.eye).cross(he),oe.copy(he).cross($t);break;case"Y":$t.copy(this.eye).cross(le),oe.copy(le).cross($t);break;case"Z":$t.copy(this.eye).cross(ue),oe.copy(ue).cross($t);break;case"XY":oe.copy(ue);break;case"YZ":oe.copy(he);break;case"XZ":$t.copy(ue),oe.copy(le);break;case"XYZ":case"E":oe.set(0,0,0)}break;default:oe.set(0,0,0)}0===oe.length()?this.quaternion.copy(this.cameraQuaternion):(se.lookAt(zt.set(0,0,0),oe,$t),this.quaternion.setFromRotationMatrix(se)),super.updateMatrixWorld(t)}}const de={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},fe={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},ye={x:0,y:0},ve={camera:new t.Matrix4,gizmos:new t.Matrix4},_e={type:"change"},ge={type:"start"},we={type:"end"},be=new t.Raycaster,Me=new t.Vector3,xe=new t.Matrix4,Ee=new t.Matrix4,Se=new t.Vector3;class Te extends t.EventDispatcher{constructor(e,i,n=null){super(),this.camera=null,this.domElement=i,this.scene=n,this.target=new t.Vector3,this._currentTarget=new t.Vector3,this.radiusFactor=.67,this.mouseActions=[],this._mouseOp=null,this._v2_1=new t.Vector2,this._v3_1=new t.Vector3,this._v3_2=new t.Vector3,this._m4_1=new t.Matrix4,this._m4_2=new t.Matrix4,this._quat=new t.Quaternion,this._translationMatrix=new t.Matrix4,this._rotationMatrix=new t.Matrix4,this._scaleMatrix=new t.Matrix4,this._rotationAxis=new t.Vector3,this._cameraMatrixState=new t.Matrix4,this._cameraProjectionState=new t.Matrix4,this._fovState=1,this._upState=new t.Vector3,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new t.Matrix4,this._up0=new t.Vector3,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new t.Matrix4,this._gizmoMatrixState0=new t.Matrix4,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=fe.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._downStart=0,this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new t.Vector3,this._startCursorPosition=new t.Vector3,this._grid=null,this._gridPosition=new t.Vector3,this._gizmos=new t.Group,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new t.Vector3,this._cursorPosCurr=new t.Vector3,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.enableGizmos=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this._tbRadius=1,this._state=de.IDLE,this.setCamera(e),null!=this.scene&&this.scene.add(this._gizmos),this.domElement.style.touchAction="none",this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("wheel",this.onWheel),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),window.addEventListener("resize",this.onWindowResize)}onWindowResize=()=>{const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;this._tbRadius=this.calculateTbRadius(this.camera);const i=this._tbRadius/e,n=new t.EllipseCurve(0,0,i,i).getPoints(this._curvePts),o=(new t.BufferGeometry).setFromPoints(n);for(const t in this._gizmos.children)this._gizmos.children[t].geometry=o;this.dispatchEvent(_e)};onContextMenu=t=>{if(this.enabled)for(let e=0;e<this.mouseActions.length;e++)if(2==this.mouseActions[e].mouse){t.preventDefault();break}};onPointerCancel=()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=fe.NONE};onPointerDown=t=>{if(0==t.button&&t.isPrimary?(this._downValid=!0,this._downEvents.push(t),this._downStart=performance.now()):this._downValid=!1,"touch"==t.pointerType&&this._input!=fe.CURSOR)switch(this._touchStart.push(t),this._touchCurrent.push(t),this._input){case fe.NONE:this._input=fe.ONE_FINGER,this.onSinglePanStart(t,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case fe.ONE_FINGER:case fe.ONE_FINGER_SWITCHED:this._input=fe.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case fe.TWO_FINGER:this._input=fe.MULT_FINGER,this.onTriplePanStart(t)}else if("touch"!=t.pointerType&&this._input==fe.NONE){let e=null;t.ctrlKey||t.metaKey?e="CTRL":t.shiftKey&&(e="SHIFT"),this._mouseOp=this.getOpFromAction(t.button,e),null!=this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=fe.CURSOR,this._button=t.button,this.onSinglePanStart(t,this._mouseOp))}};onPointerMove=t=>{if("touch"==t.pointerType&&this._input!=fe.CURSOR)switch(this._input){case fe.ONE_FINGER:this.updateTouchEvent(t),this.onSinglePanMove(t,de.ROTATE);break;case fe.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],t)*this._devPxRatio>=this._switchSensibility){this._input=fe.ONE_FINGER,this.updateTouchEvent(t),this.onSinglePanStart(t,"ROTATE");break}break;case fe.TWO_FINGER:this.updateTouchEvent(t),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case fe.MULT_FINGER:this.updateTouchEvent(t),this.onTriplePanMove(t)}else if("touch"!=t.pointerType&&this._input==fe.CURSOR){let e=null;t.ctrlKey||t.metaKey?e="CTRL":t.shiftKey&&(e="SHIFT");const i=this.getOpStateFromAction(this._button,e);null!=i&&this.onSinglePanMove(t,i)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],t)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)};onPointerUp=t=>{if("touch"==t.pointerType&&this._input!=fe.CURSOR){const e=this._touchCurrent.length;for(let i=0;i<e;i++)if(this._touchCurrent[i].pointerId==t.pointerId){this._touchCurrent.splice(i,1),this._touchStart.splice(i,1);break}switch(this._input){case fe.ONE_FINGER:case fe.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=fe.NONE,this.onSinglePanEnd();break;case fe.TWO_FINGER:this.onDoublePanEnd(t),this.onPinchEnd(t),this.onRotateEnd(t),this._input=fe.ONE_FINGER_SWITCHED;break;case fe.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=fe.NONE,this.onTriplePanEnd())}}else"touch"!=t.pointerType&&this._input==fe.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=fe.NONE,this.onSinglePanEnd(),this._button=-1);if(t.isPrimary)if(this._downValid)if(t.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{const e=t.timeStamp-this._clickStart,i=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;e<=this._maxInterval&&i<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(t)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)};onWheel=e=>{if(this.enabled&&this.enableZoom){let i=null;e.ctrlKey||e.metaKey?i="CTRL":e.shiftKey&&(i="SHIFT");const n=this.getOpFromAction("WHEEL",i);if(null!=n){e.preventDefault(),this.dispatchEvent(ge);const i=125;let o=e.deltaY/i,s=1;switch(o>0?s=1/this.scaleFactor:o<0&&(s=this.scaleFactor),n){case"ZOOM":if(this.updateTbState(de.SCALE,!0),o>0?s=1/Math.pow(this.scaleFactor,o):o<0&&(s=Math.pow(this.scaleFactor,-o)),this.cursorZoom&&this.enablePan){let t;this.camera.isOrthographicCamera?t=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera.isPerspectiveCamera&&(t=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement).applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),this.applyTransformMatrix(this.scale(s,t))}else this.applyTransformMatrix(this.scale(s,this._gizmos.position));null!=this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(de.IDLE,!1),this.dispatchEvent(_e),this.dispatchEvent(we);break;case"FOV":if(this.camera.isPerspectiveCamera){this.updateTbState(de.FOV,!0),0!=e.deltaX&&(o=e.deltaX/i,s=1,o>0?s=1/Math.pow(this.scaleFactor,o):o<0&&(s=Math.pow(this.scaleFactor,-o))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const n=this._v3_1.distanceTo(this._gizmos.position);let r=n/s;r=t.MathUtils.clamp(r,this.minDistance,this.maxDistance);const a=n*Math.tan(t.MathUtils.DEG2RAD*this.camera.fov*.5);let c=t.MathUtils.RAD2DEG*(2*Math.atan(a/r));c>this.maxFov?c=this.maxFov:c<this.minFov&&(c=this.minFov),s=n/(a/Math.tan(t.MathUtils.DEG2RAD*(c/2))),this.setFov(c),this.applyTransformMatrix(this.scale(s,this._gizmos.position,!1))}null!=this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(de.IDLE,!1),this.dispatchEvent(_e),this.dispatchEvent(we)}}}};onSinglePanStart=(t,e)=>{if(this.enabled)switch(this.dispatchEvent(ge),this.setCenter(t.clientX,t.clientY),e){case"PAN":if(!this.enablePan)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(_e)),this.updateTbState(de.PAN,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ye.x,ye.y,this.domElement)),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(_e));break;case"ROTATE":if(!this.enableRotate)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.updateTbState(de.ROTATE,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ye.x,ye.y,this.domElement,this._tbRadius)),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr),this.dispatchEvent(_e);break;case"FOV":if(!this.camera.isPerspectiveCamera||!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(_e)),this.updateTbState(de.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ye.x,ye.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition);break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(_e)),this.updateTbState(de.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ye.x,ye.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}};onSinglePanMove=(e,i)=>{if(this.enabled){const n=i!=this._state;switch(this.setCenter(e.clientX,e.clientY),i){case de.PAN:this.enablePan&&(n?(this.dispatchEvent(we),this.dispatchEvent(ge),this.updateTbState(i,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ye.x,ye.y,this.domElement)),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)):(this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ye.x,ye.y,this.domElement)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))));break;case de.ROTATE:if(this.enableRotate)if(n)this.dispatchEvent(we),this.dispatchEvent(ge),this.updateTbState(i,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ye.x,ye.y,this.domElement,this._tbRadius)),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0);else{this._currentCursorPosition.copy(this.unprojectOnTbSurface(this.camera,ye.x,ye.y,this.domElement,this._tbRadius));const t=this._startCursorPosition.distanceTo(this._currentCursorPosition),e=this._startCursorPosition.angleTo(this._currentCursorPosition),i=Math.max(t/this._tbRadius,e);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),i)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=i,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case de.SCALE:if(this.enableZoom)if(n)this.dispatchEvent(we),this.dispatchEvent(ge),this.updateTbState(i,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ye.x,ye.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{const t=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(ye.x,ye.y,this.domElement).y);const e=this._currentCursorPosition.y-this._startCursorPosition.y;let i=1;e<0?i=1/Math.pow(this.scaleFactor,-e*t):e>0&&(i=Math.pow(this.scaleFactor,e*t)),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this.applyTransformMatrix(this.scale(i,this._v3_1))}break;case de.FOV:if(this.enableZoom&&this.camera.isPerspectiveCamera)if(n)this.dispatchEvent(we),this.dispatchEvent(ge),this.updateTbState(i,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(ye.x,ye.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{const e=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(ye.x,ye.y,this.domElement).y);const i=this._currentCursorPosition.y-this._startCursorPosition.y;let n=1;i<0?n=1/Math.pow(this.scaleFactor,-i*e):i>0&&(n=Math.pow(this.scaleFactor,i*e)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const o=this._v3_1.distanceTo(this._gizmos.position);let s=o/n;s=t.MathUtils.clamp(s,this.minDistance,this.maxDistance);const r=o*Math.tan(t.MathUtils.DEG2RAD*this._fovState*.5);let a=t.MathUtils.RAD2DEG*(2*Math.atan(r/s));a=t.MathUtils.clamp(a,this.minFov,this.maxFov);const c=r/Math.tan(t.MathUtils.DEG2RAD*(a/2));n=o/c,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(a),this.applyTransformMatrix(this.scale(n,this._v3_2,!1)),Me.copy(this._gizmos.position).sub(this.camera.position).normalize().multiplyScalar(c/o),this._m4_1.makeTranslation(Me.x,Me.y,Me.z)}}this.dispatchEvent(_e)}};onSinglePanEnd=()=>{if(this._state==de.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){const t=Math.abs((this._wPrev+this._wCurr)/2),e=this;this._animationId=window.requestAnimationFrame((function(i){e.updateTbState(de.ANIMATION_ROTATE,!0);const n=e.calculateRotationAxis(e._cursorPosPrev,e._cursorPosCurr);e.onRotationAnim(i,n,Math.min(t,e.wMax))}))}else this.updateTbState(de.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_e);else this.updateTbState(de.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_e)}else this._state!=de.PAN&&this._state!=de.IDLE||(this.updateTbState(de.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(_e));this.dispatchEvent(we)};onDoubleTap=t=>{if(this.enabled&&this.enablePan&&null!=this.scene){this.dispatchEvent(ge),this.setCenter(t.clientX,t.clientY);const e=this.unprojectOnObj(this.getCursorNDC(ye.x,ye.y,this.domElement),this.camera);if(null!=e&&this.enableAnimations){const t=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame((function(i){t.updateTbState(de.ANIMATION_FOCUS,!0),t.onFocusAnim(i,e,t._cameraMatrixState,t._gizmoMatrixState)}))}else null==e||this.enableAnimations||(this.updateTbState(de.FOCUS,!0),this.focus(e,this.scaleFactor),this.updateTbState(de.IDLE,!1),this.dispatchEvent(_e))}this.dispatchEvent(we)};onDoublePanStart=()=>{this.enabled&&this.enablePan&&(this.dispatchEvent(ge),this.updateTbState(de.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ye.x,ye.y,this.domElement,!0)),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1))};onDoublePanMove=()=>{this.enabled&&this.enablePan&&(this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=de.PAN&&(this.updateTbState(de.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition)),this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.camera,ye.x,ye.y,this.domElement,!0)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(_e))};onDoublePanEnd=()=>{this.updateTbState(de.IDLE,!1),this.dispatchEvent(we)};onRotateStart=()=>{this.enabled&&this.enableRotate&&(this.dispatchEvent(ge),this.updateTbState(de.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,this.camera.getWorldDirection(this._rotationAxis),this.enablePan||this.enableZoom||this.activateGizmos(!0))};onRotateMove=()=>{if(this.enabled&&this.enableRotate){let e;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=de.ZROTATE&&(this.updateTbState(de.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),e=this.unprojectOnTbPlane(this.camera,ye.x,ye.y,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):e=(new t.Vector3).setFromMatrixPosition(this._gizmoMatrixState);const i=t.MathUtils.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);this.applyTransformMatrix(this.zRotate(e,i)),this.dispatchEvent(_e)}};onRotateEnd=()=>{this.updateTbState(de.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(we)};onPinchStart=()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(ge),this.updateTbState(de.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))};onPinchMove=()=>{if(this.enabled&&this.enableZoom){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const t=12;this._state!=de.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(de.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),t*this._devPxRatio);const e=this._currentFingerDistance/this._startFingerDistance;let i;this.enablePan?this.camera.isOrthographicCamera?i=this.unprojectOnTbPlane(this.camera,ye.x,ye.y,this.domElement).applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera.isPerspectiveCamera&&(i=this.unprojectOnTbPlane(this.camera,ye.x,ye.y,this.domElement).applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):i=this._gizmos.position,this.applyTransformMatrix(this.scale(e,i)),this.dispatchEvent(_e)}};onPinchEnd=()=>{this.updateTbState(de.IDLE,!1),this.dispatchEvent(we)};onTriplePanStart=()=>{if(this.enabled&&this.enableZoom){this.dispatchEvent(ge),this.updateTbState(de.SCALE,!0);let t=0,e=0;const i=this._touchCurrent.length;for(let n=0;n<i;n++)t+=this._touchCurrent[n].clientX,e+=this._touchCurrent[n].clientY;this.setCenter(t/i,e/i),this._startCursorPosition.setY(.5*this.getCursorNDC(ye.x,ye.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}};onTriplePanMove=()=>{if(this.enabled&&this.enableZoom){let e=0,i=0;const n=this._touchCurrent.length;for(let t=0;t<n;t++)e+=this._touchCurrent[t].clientX,i+=this._touchCurrent[t].clientY;this.setCenter(e/n,i/n);const o=8;this._currentCursorPosition.setY(.5*this.getCursorNDC(ye.x,ye.y,this.domElement).y);const s=this._currentCursorPosition.y-this._startCursorPosition.y;let r=1;s<0?r=1/Math.pow(this.scaleFactor,-s*o):s>0&&(r=Math.pow(this.scaleFactor,s*o)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const a=this._v3_1.distanceTo(this._gizmos.position);let c=a/r;c=t.MathUtils.clamp(c,this.minDistance,this.maxDistance);const h=a*Math.tan(t.MathUtils.DEG2RAD*this._fovState*.5);let l=t.MathUtils.RAD2DEG*(2*Math.atan(h/c));l=t.MathUtils.clamp(l,this.minFov,this.maxFov);const u=h/Math.tan(t.MathUtils.DEG2RAD*(l/2));r=a/u,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(l),this.applyTransformMatrix(this.scale(r,this._v3_2,!1)),Me.copy(this._gizmos.position).sub(this.camera.position).normalize().multiplyScalar(u/a),this._m4_1.makeTranslation(Me.x,Me.y,Me.z),this.dispatchEvent(_e)}};onTriplePanEnd=()=>{this.updateTbState(de.IDLE,!1),this.dispatchEvent(we)};setCenter=(t,e)=>{ye.x=t,ye.y=e};initializeMouseActions=()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")};compareMouseAction=(t,e)=>t.operation==e.operation&&t.mouse==e.mouse&&t.key==e.key;setMouseAction=(t,e,i=null)=>{let n;if(!["PAN","ROTATE","ZOOM","FOV"].includes(t)||![0,1,2,"WHEEL"].includes(e)||!["CTRL","SHIFT",null].includes(i))return!1;if("WHEEL"==e&&"ZOOM"!=t&&"FOV"!=t)return!1;switch(t){case"PAN":n=de.PAN;break;case"ROTATE":n=de.ROTATE;break;case"ZOOM":n=de.SCALE;break;case"FOV":n=de.FOV}const o={operation:t,mouse:e,key:i,state:n};for(let t=0;t<this.mouseActions.length;t++)if(this.mouseActions[t].mouse==o.mouse&&this.mouseActions[t].key==o.key)return this.mouseActions.splice(t,1,o),!0;return this.mouseActions.push(o),!0};unsetMouseAction=(t,e=null)=>{for(let i=0;i<this.mouseActions.length;i++)if(this.mouseActions[i].mouse==t&&this.mouseActions[i].key==e)return this.mouseActions.splice(i,1),!0;return!1};getOpFromAction=(t,e)=>{let i;for(let n=0;n<this.mouseActions.length;n++)if(i=this.mouseActions[n],i.mouse==t&&i.key==e)return i.operation;if(null!=e)for(let e=0;e<this.mouseActions.length;e++)if(i=this.mouseActions[e],i.mouse==t&&null==i.key)return i.operation;return null};getOpStateFromAction=(t,e)=>{let i;for(let n=0;n<this.mouseActions.length;n++)if(i=this.mouseActions[n],i.mouse==t&&i.key==e)return i.state;if(null!=e)for(let e=0;e<this.mouseActions.length;e++)if(i=this.mouseActions[e],i.mouse==t&&null==i.key)return i.state;return null};getAngle=(t,e)=>180*Math.atan2(e.clientY-t.clientY,e.clientX-t.clientX)/Math.PI;updateTouchEvent=t=>{for(let e=0;e<this._touchCurrent.length;e++)if(this._touchCurrent[e].pointerId==t.pointerId){this._touchCurrent.splice(e,1,t);break}};applyTransformMatrix(e){if(null!=e.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),this._state!=de.ROTATE&&this._state!=de.ZROTATE&&this._state!=de.ANIMATION_ROTATE||this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),null!=e.gizmos&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),this._state==de.SCALE||this._state==de.FOCUS||this._state==de.ANIMATION_FOCUS)if(this._tbRadius=this.calculateTbRadius(this.camera),this.adjustNearFar){const e=this.camera.position.distanceTo(this._gizmos.position),i=new t.Box3;i.setFromObject(this._gizmos);const n=new t.Sphere;i.getBoundingSphere(n);const o=Math.max(this._nearPos0,n.radius+n.center.length()),s=e-this._initialNear,r=Math.min(o,s);this.camera.near=e-r;const a=Math.min(this._farPos0,-n.radius+n.center.length()),c=e-this._initialFar,h=Math.min(a,c);this.camera.far=e-h,this.camera.updateProjectionMatrix()}else{let t=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,t=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,t=!0),t&&this.camera.updateProjectionMatrix()}}calculateAngularSpeed=(t,e,i,n)=>{const o=(n-i)/1e3;return 0==o?0:(e-t)/o};calculatePointersDistance=(t,e)=>Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2));calculateRotationAxis=(t,e)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(t,e).applyQuaternion(this._quat),this._rotationAxis.normalize().clone());calculateTbRadius=e=>{const i=e.position.distanceTo(this._gizmos.position);if("PerspectiveCamera"==e.type){const n=t.MathUtils.DEG2RAD*e.fov*.5,o=Math.atan(e.aspect*Math.tan(n));return Math.tan(Math.min(n,o))*i*this.radiusFactor}if("OrthographicCamera"==e.type)return Math.min(e.top,e.right)*this.radiusFactor};focus=(t,e,i=1)=>{Me.copy(t).sub(this._gizmos.position).multiplyScalar(i),this._translationMatrix.makeTranslation(Me.x,Me.y,Me.z),xe.copy(this._gizmoMatrixState),this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),Ee.copy(this._cameraMatrixState),this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.scale(e,this._gizmos.position)),this._gizmoMatrixState.copy(xe),this._cameraMatrixState.copy(Ee)};drawGrid=()=>{if(null!=this.scene){const e=8947848,i=3;let n,o,s,r;if(this.camera.isOrthographicCamera){const t=this.camera.right-this.camera.left,e=this.camera.bottom-this.camera.top;s=Math.max(t,e),r=s/20,n=s/this.camera.zoom*i,o=n/r*this.camera.zoom}else if(this.camera.isPerspectiveCamera){const e=this.camera.position.distanceTo(this._gizmos.position),a=t.MathUtils.DEG2RAD*this.camera.fov*.5,c=Math.atan(this.camera.aspect*Math.tan(a));s=Math.tan(Math.max(a,c))*e*2,r=s/20,n=s*i,o=n/r}null==this._grid&&(this._grid=new t.GridHelper(n,o,e,e),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}};dispose=()=>{-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointercancel",this.onPointerCancel),this.domElement.removeEventListener("wheel",this.onWheel),this.domElement.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),null!==this.scene&&this.scene.remove(this._gizmos),this.disposeGrid()};disposeGrid=()=>{null!=this._grid&&null!=this.scene&&(this.scene.remove(this._grid),this._grid=null)};easeOutCubic=t=>1-Math.pow(1-t,3);activateGizmos=t=>{const e=this._gizmos.children[0],i=this._gizmos.children[1],n=this._gizmos.children[2];t?(e.material.setValues({opacity:1}),i.material.setValues({opacity:1}),n.material.setValues({opacity:1})):(e.material.setValues({opacity:.6}),i.material.setValues({opacity:.6}),n.material.setValues({opacity:.6}))};getCursorNDC=(t,e,i)=>{const n=i.getBoundingClientRect();return this._v2_1.setX((t-n.left)/n.width*2-1),this._v2_1.setY((n.bottom-e)/n.height*2-1),this._v2_1.clone()};getCursorPosition=(t,e,i)=>(this._v2_1.copy(this.getCursorNDC(t,e,i)),this._v2_1.x*=.5*(this.camera.right-this.camera.left),this._v2_1.y*=.5*(this.camera.top-this.camera.bottom),this._v2_1.clone());setCamera=t=>{t.lookAt(this.target),t.updateMatrix(),"PerspectiveCamera"==t.type&&(this._fov0=t.fov,this._fovState=t.fov),this._cameraMatrixState0.copy(t.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(t.projectionMatrix),this._zoom0=t.zoom,this._zoomState=this._zoom0,this._initialNear=t.near,this._nearPos0=t.position.distanceTo(this.target)-t.near,this._nearPos=this._initialNear,this._initialFar=t.far,this._farPos0=t.position.distanceTo(this.target)-t.far,this._farPos=this._initialFar,this._up0.copy(t.up),this._upState.copy(t.up),this.camera=t,this.camera.updateProjectionMatrix(),this._tbRadius=this.calculateTbRadius(t),this.makeGizmos(this.target,this._tbRadius)};setGizmosVisible(t){this._gizmos.visible=t,this.dispatchEvent(_e)}setTbRadius(e){this.radiusFactor=e,this._tbRadius=this.calculateTbRadius(this.camera);const i=new t.EllipseCurve(0,0,this._tbRadius,this._tbRadius).getPoints(this._curvePts),n=(new t.BufferGeometry).setFromPoints(i);for(const t in this._gizmos.children)this._gizmos.children[t].geometry=n;this.dispatchEvent(_e)}makeGizmos=(e,i)=>{const n=new t.EllipseCurve(0,0,i,i).getPoints(this._curvePts),o=(new t.BufferGeometry).setFromPoints(n),s=new t.LineBasicMaterial({color:16744576,fog:!1,transparent:!0,opacity:.6}),r=new t.LineBasicMaterial({color:8454016,fog:!1,transparent:!0,opacity:.6}),a=new t.LineBasicMaterial({color:8421631,fog:!1,transparent:!0,opacity:.6}),c=new t.Line(o,s),h=new t.Line(o,r),l=new t.Line(o,a),u=.5*Math.PI;if(c.rotation.x=u,h.rotation.y=u,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),1!==this.camera.zoom){const t=1/this.camera.zoom;this._scaleMatrix.makeScale(t,t,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.traverse((function(t){t.isLine&&(t.geometry.dispose(),t.material.dispose())})),this._gizmos.clear(),this._gizmos.add(c),this._gizmos.add(h),this._gizmos.add(l)};onFocusAnim=(t,e,i,n)=>{if(-1==this._timeStart&&(this._timeStart=t),this._state==de.ANIMATION_FOCUS){const o=(t-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(n),o>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(e,this.scaleFactor),this._timeStart=-1,this.updateTbState(de.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_e);else{const t=this.easeOutCubic(o),s=1-t+this.scaleFactor*t;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(e,s,t),this.dispatchEvent(_e);const r=this;this._animationId=window.requestAnimationFrame((function(t){r.onFocusAnim(t,e,i,n.clone())}))}}else this._animationId=-1,this._timeStart=-1};onRotationAnim=(t,e,i)=>{if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=t),this._state==de.ANIMATION_ROTATE){const n=(t-this._timeStart)/1e3;if(i+-this.dampingFactor*n>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(n,2)+i*n+0,this.applyTransformMatrix(this.rotate(e,this._angleCurrent)),this.dispatchEvent(_e);const t=this;this._animationId=window.requestAnimationFrame((function(n){t.onRotationAnim(n,e,i)}))}else this._animationId=-1,this._timeStart=-1,this.updateTbState(de.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_e)}else this._animationId=-1,this._timeStart=-1,this._state!=de.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(_e))};pan=(t,e,i=!1)=>{const n=t.clone().sub(e);if(this.camera.isOrthographicCamera)n.multiplyScalar(1/this.camera.zoom);else if(this.camera.isPerspectiveCamera&&i){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const t=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);n.multiplyScalar(1/t)}return this._v3_1.set(n.x,n.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1),ve};reset=()=>{this.camera.zoom=this._zoom0,this.camera.isPerspectiveCamera&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.camera),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(de.IDLE,!1),this.dispatchEvent(_e)};rotate=(t,e)=>{const i=this._gizmos.position;return this._translationMatrix.makeTranslation(-i.x,-i.y,-i.z),this._rotationMatrix.makeRotationAxis(t,-e),this._m4_1.makeTranslation(i.x,i.y,i.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),ve};copyState=()=>{let t;this.camera.isOrthographicCamera?t=JSON.stringify({arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}):this.camera.isPerspectiveCamera&&(t=JSON.stringify({arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}})),navigator.clipboard.writeText(t)};pasteState=()=>{const t=this;navigator.clipboard.readText().then((function(e){t.setStateFromJSON(e)}))};saveState=()=>{this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera.isPerspectiveCamera&&(this._fov0=this.camera.fov)};scale=(t,e,i=!0)=>{Se.copy(e);let n=1/t;if(this.camera.isOrthographicCamera){this.camera.zoom=this._zoomState,this.camera.zoom*=t,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,n=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,n=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(n,n,n),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),Se.sub(this._v3_1);const e=Se.clone().multiplyScalar(n);return Se.sub(e),this._m4_1.makeTranslation(Se.x,Se.y,Se.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),ve}if(this.camera.isPerspectiveCamera){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let t=this._v3_1.distanceTo(Se),e=t-t*n;const o=t-e;if(o<this.minDistance?(n=this.minDistance/t,e=t-t*n):o>this.maxDistance&&(n=this.maxDistance/t,e=t-t*n),Me.copy(Se).sub(this._v3_1).normalize().multiplyScalar(e),this._m4_1.makeTranslation(Me.x,Me.y,Me.z),i){const i=this._v3_2;t=i.distanceTo(Se),e=t-t*n,Me.copy(Se).sub(this._v3_2).normalize().multiplyScalar(e),this._translationMatrix.makeTranslation(i.x,i.y,i.z),this._scaleMatrix.makeScale(n,n,n),this._m4_2.makeTranslation(Me.x,Me.y,Me.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-i.x,-i.y,-i.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return ve}};setFov=e=>{this.camera.isPerspectiveCamera&&(this.camera.fov=t.MathUtils.clamp(e,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())};setTransformationMatrices(t=null,e=null){null!=t?null!=ve.camera?ve.camera.copy(t):ve.camera=t.clone():ve.camera=null,null!=e?null!=ve.gizmos?ve.gizmos.copy(e):ve.gizmos=e.clone():ve.gizmos=null}zRotate=(t,e)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,e),this._translationMatrix.makeTranslation(-t.x,-t.y,-t.z),this._m4_1.makeTranslation(t.x,t.y,t.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(t),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,e),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),ve);getRaycaster(){return be}unprojectOnObj=(t,e)=>{const i=this.getRaycaster();i.near=e.near,i.far=e.far,i.setFromCamera(t,e);const n=i.intersectObjects(this.scene.children,!0);for(let t=0;t<n.length;t++)if(n[t].object.uuid!=this._gizmos.uuid&&null!=n[t].face)return n[t].point.clone();return null};unprojectOnTbSurface=(e,i,n,o,s)=>{if("OrthographicCamera"==e.type){this._v2_1.copy(this.getCursorPosition(i,n,o)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const t=Math.pow(this._v2_1.x,2),e=Math.pow(this._v2_1.y,2),s=Math.pow(this._tbRadius,2);return t+e<=.5*s?this._v3_1.setZ(Math.sqrt(s-(t+e))):this._v3_1.setZ(.5*s/Math.sqrt(t+e)),this._v3_1}if("PerspectiveCamera"==e.type){this._v2_1.copy(this.getCursorNDC(i,n,o)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);const r=this._v3_1.clone().normalize(),a=e.position.distanceTo(this._gizmos.position),c=Math.pow(s,2),h=this._v3_1.z,l=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==l)return r.set(this._v3_1.x,this._v3_1.y,s),r;const u=h/l,m=a;let p=Math.pow(u,2)+1,d=2*u*m,f=Math.pow(m,2)-c,y=Math.pow(d,2)-4*p*f;if(y>=0&&(this._v2_1.setX((-d-Math.sqrt(y))/(2*p)),this._v2_1.setY(u*this._v2_1.x+m),t.MathUtils.RAD2DEG*this._v2_1.angle()>=45)){const t=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(a-this._v2_1.y,2));return r.multiplyScalar(t),r.z+=a,r}p=u,d=m,f=.5*-c,y=Math.pow(d,2)-4*p*f,this._v2_1.setX((-d-Math.sqrt(y))/(2*p)),this._v2_1.setY(u*this._v2_1.x+m);const v=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(a-this._v2_1.y,2));return r.multiplyScalar(v),r.z+=a,r}};unprojectOnTbPlane=(t,e,i,n,o=!1)=>{if("OrthographicCamera"==t.type)return this._v2_1.copy(this.getCursorPosition(e,i,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if("PerspectiveCamera"==t.type){this._v2_1.copy(this.getCursorNDC(e,i,n)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(t.projectionMatrixInverse);const s=this._v3_1.clone().normalize(),r=this._v3_1.z,a=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let c;if(c=o?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):t.position.distanceTo(this._gizmos.position),0==a)return s.set(0,0,0),s;const h=c,l=-h/(r/a),u=Math.sqrt(Math.pow(h,2)+Math.pow(l,2));return s.multiplyScalar(u),s.z=0,s}};updateMatrixState=()=>{this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera.isOrthographicCamera?(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom):this.camera.isPerspectiveCamera&&(this._fovState=this.camera.fov)};updateTbState=(t,e)=>{this._state=t,e&&this.updateMatrixState()};update=()=>{const e=1e-6;if(!1===this.target.equals(this._currentTarget)&&(this._gizmos.position.copy(this.target),this._tbRadius=this.calculateTbRadius(this.camera),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)),this.camera.isOrthographicCamera){if(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom){const e=t.MathUtils.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.scale(e/this.camera.zoom,this._gizmos.position,!0))}}else if(this.camera.isPerspectiveCamera){const i=this.camera.position.distanceTo(this._gizmos.position);if(i>this.maxDistance+e||i<this.minDistance-e){const e=t.MathUtils.clamp(i,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.scale(e/i,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=t.MathUtils.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());const n=this._tbRadius;if(this._tbRadius=this.calculateTbRadius(this.camera),n<this._tbRadius-e||n>this._tbRadius+e){const e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,i=this._tbRadius/e,n=new t.EllipseCurve(0,0,i,i).getPoints(this._curvePts),o=(new t.BufferGeometry).setFromPoints(n);for(const t in this._gizmos.children)this._gizmos.children[t].geometry=o}}this.camera.lookAt(this._gizmos.position)};setStateFromJSON=e=>{const i=JSON.parse(e);if(null!=i.arcballState){this._cameraMatrixState.fromArray(i.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(i.arcballState.cameraUp),this.camera.near=i.arcballState.cameraNear,this.camera.far=i.arcballState.cameraFar,this.camera.zoom=i.arcballState.cameraZoom,this.camera.isPerspectiveCamera&&(this.camera.fov=i.arcballState.cameraFov),this._gizmoMatrixState.fromArray(i.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.camera);const e=(new t.Matrix4).copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(e),this.camera.lookAt(this._gizmos.position),this.updateTbState(de.IDLE,!1),this.dispatchEvent(_e)}}}var Ae={OrbitControls:ht,DragControls:vt,FirstPersonControls:class{constructor(e,i){this.object=e,this.domElement=i,this.enabled=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.viewHalfX=0,this.viewHalfY=0;let n=0,o=0;this.handleResize=function(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)},this.onPointerDown=function(t){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(t.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0},this.onPointerUp=function(t){if(this.activeLook)switch(t.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1},this.onPointerMove=function(t){this.domElement===document?(this.pointerX=t.pageX-this.viewHalfX,this.pointerY=t.pageY-this.viewHalfY):(this.pointerX=t.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=t.pageY-this.domElement.offsetTop-this.viewHalfY)},this.onKeyDown=function(t){switch(t.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}},this.onKeyUp=function(t){switch(t.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}},this.lookAt=function(t,e,i){return t.isVector3?wt.copy(t):wt.set(t,e,i),this.object.lookAt(wt),l(this),this},this.update=function(){const e=new t.Vector3;return function(i){if(!1===this.enabled)return;if(this.heightSpeed){const e=t.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=i*(e*this.heightCoef)}else this.autoSpeedFactor=0;const s=i*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(s+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(s),this.moveLeft&&this.object.translateX(-s),this.moveRight&&this.object.translateX(s),this.moveUp&&this.object.translateY(s),this.moveDown&&this.object.translateY(-s);let r=i*this.lookSpeed;this.activeLook||(r=0);let a=1;this.constrainVertical&&(a=Math.PI/(this.verticalMax-this.verticalMin)),o-=this.pointerX*r,this.lookVertical&&(n-=this.pointerY*r*a),n=Math.max(-85,Math.min(85,n));let c=t.MathUtils.degToRad(90-n);const h=t.MathUtils.degToRad(o);this.constrainVertical&&(c=t.MathUtils.mapLinear(c,0,Math.PI,this.verticalMin,this.verticalMax));const l=this.object.position;e.setFromSphericalCoords(1,c,h).add(l),this.object.lookAt(e)}}(),this.dispose=function(){this.domElement.removeEventListener("contextmenu",bt),this.domElement.removeEventListener("pointerdown",r),this.domElement.removeEventListener("pointermove",s),this.domElement.removeEventListener("pointerup",a),window.removeEventListener("keydown",c),window.removeEventListener("keyup",h)};const s=this.onPointerMove.bind(this),r=this.onPointerDown.bind(this),a=this.onPointerUp.bind(this),c=this.onKeyDown.bind(this),h=this.onKeyUp.bind(this);function l(e){const i=e.object.quaternion;_t.set(0,0,-1).applyQuaternion(i),gt.setFromVector3(_t),n=90-t.MathUtils.radToDeg(gt.phi),o=t.MathUtils.radToDeg(gt.theta)}this.domElement.addEventListener("contextmenu",bt),this.domElement.addEventListener("pointerdown",r),this.domElement.addEventListener("pointermove",s),this.domElement.addEventListener("pointerup",a),window.addEventListener("keydown",c),window.addEventListener("keyup",h),this.handleResize(),l(this)}},FlyControls:xt,PointerLockControls:Ct,TrackballControls:Nt,TransformControls:Yt},Pe=function(){return Pe=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},Pe.apply(this,arguments)},Re={Geometry:function(t,e){var n=e.prefix;t.directive("".concat(n,"geometry"),(function(t,e,n){var o=e.expression,r=n.evaluateLater,a=n.effect,c=r(o);a((function(){var e=t._norska.mesh;if(!e)throw new Error("You must define a mesh with x-mesh before defining a geometry");e.geometry.userData.updated?c((function(t){var i=s(t,3)[2];Object.assign(e.geometry,i)})):c((function(t){var n=s(t,3),o=n[0],r=n[1],a=n[2];e.geometry=i[o](r),Object.assign(e.geometry,a),e.geometry.userData.updated=!0}))}))}))},Material:function(e,i){var n=i.prefix;e.directive("".concat(n,"material"),(function(e,i,n){var o=i.expression,s=n.evaluateLater,a=n.effect,c=s(o);a((function(){var i=e._norska.mesh;i&&((null==i?void 0:i.material.userData.updated)?c((function(t){var e=r(t,2)[1],n=e.color,o=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]])}return i}(e,["color"]);n&&i.material.color.set(n),Object.assign(i.material,o)})):c((function(e){var n=r(e,2),o=n[0],s=n[1];i.material=new t[o](s),i.material.userData.updated=!0})))}))}))},Mesh:function(e,i){var n=i.prefix;e.directive("".concat(n,"mesh"),(function(e,i,n){var o=n.cleanup,s=window.Norska.scene;e.hasOwnProperty("_norska")||(e._norska={}),e._norska.mesh=new t.Mesh,s.add(e._norska.mesh),o((function(){s.remove(e._norska.mesh)}))}))},Light:function(t,e){var i=e.prefix;t.directive("".concat(i,"light"),(function(t,e,i){var n=e.expression,o=i.evaluateLater,s=i.effect,r=o(n),h=window.Norska.scene;s((function(){var e=t._norska.light;r(e?function(t){var i=c(t,3)[2];Object.assign(e,i)}:function(e){var i=c(e,3),n=i[0],o=i[1],s=i[2];t._norska.light=new a[n](o),Object.assign(t._norska.light,s),h.add(t._norska.light)})}))}))},Position:function(t,e){var i=e.prefix;t.directive("".concat(i,"position"),(function(t,e,i){var n=e.expression,o=i.evaluateLater,s=i.effect,r=o(n);s((function(){var e=t._norska,i=e.mesh,n=e.light;r((function(t){var e,o;i&&(e=i.position).set.apply(e,l([],h(t),!1)),n&&(o=n.position).set.apply(o,l([],h(t),!1))}))}))}))},Scale:function(t,e){var i=e.prefix;t.directive("".concat(i,"scale"),(function(t,e,i){var n=e.expression,o=i.evaluateLater,s=i.effect,r=o(n);s((function(){var e=t._norska,i=e.mesh;e.light,r((function(t){var e;i&&(e=i.scale).set.apply(e,function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(t),!1))}))}))}))},Rotation:function(t,e){var i=e.prefix;t.directive("".concat(i,"rotation"),(function(t,e,i){var n=e.expression,o=i.evaluateLater,s=i.effect,r=o(n);s((function(){var e=t._norska,i=e.mesh,n=e.light;r((function(t){var e,o;i&&(e=i.rotation).set.apply(e,m([],u(t),!1)),n&&(o=n.rotation).set.apply(o,m([],u(t),!1))}))}))}))},Camera:function(t,e){var i=e.prefix;t.directive("".concat(i,"camera"),(function(t,e,i){var n=e.expression,o=i.evaluateLater,s=i.effect,r=window.Norska.camera,a=o(n);s((function(){a((function(t){var e,i;t.position&&(e=r.position).set.apply(e,d([],p(t.position),!1)),t.rotation&&(i=r.rotation).set.apply(i,d([],p(t.rotation),!1)),t.lookAt&&r.lookAt.apply(r,d([],p(t.lookAt),!1))}))}))}))},Canvas:function(e,i){var n=i.prefix;e.directive("".concat(n,"canvas"),(function(e){var i=window.Norska={scene:new t.Scene,camera:new t.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),renderer:new t.WebGLRenderer,controls:null},n=i.scene,o=i.camera,s=i.renderer,r=document.createElement("div");r.style.width="100%",r.style.height="100%",function(t,e,i){if(i||2===arguments.length)for(var n,o=0,s=e.length;o<s;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}([],function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(e.querySelectorAll("*")),!1).forEach((function(t){t._norska={}})),e.insertAdjacentElement("beforebegin",r);var a=function(){var t=function(){var t=r.getBoundingClientRect();return{width:t.width,height:t.height}}(),e=t.width,i=t.height;o.aspect=e/i,o.updateProjectionMatrix(),s.setSize(e,i)};window.addEventListener("resize",a),r.appendChild(s.domElement),e.style.display="none",a();var c=function(){requestAnimationFrame(c),window.Norska.controls&&window.Norska.controls.update(),s.render(n,o)};c()}))},Scene:function(e,i){var n=i.prefix;e.directive("".concat(n,"scene"),(function(e,i,n){var o=i.expression,s=n.evaluateLater,r=n.effect,a=window.Norska.scene,c=s(o);r((function(){c((function(e){var i=e.background;i&&(i instanceof t.Color&&a.background.set(i),i instanceof t.Texture?a.background=i:a.background=new t.Color(i))}))}))}))},Load:function(t,e){var i=e.prefix;t.directive("".concat(i,"load"),(function(t,e,i){var n=e.expression,o=i.evaluateLater,s=i.effect,r=o(n);s((function(){r((function(t){var e=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(t,1)[0];(new f).load(e,(function(t){var e=t.scene.children[0];window.Norska.scene.add(e)}))}))}))}))},Controls:function(t){t.directive("controls",(function(t,e,i){var n=e.expression,o=i.evaluateLater,s=i.effect,r=window.Norska,a=r.renderer,c=r.camera,h=r.scene,l=r.controls,u=o(n);s((function(){u((function(t){var e,i=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r}(t,2),n=i[0],o=i[1];l?l=Object.assign(l,o):(l=new Ae[n](c,a.domElement,null!==(e=Ae.Camera instanceof Te)&&void 0!==e?e:h)).update()}))}))}))},Three:function(e,i){var n=i.prefix;e.magic("".concat(n,"three"),(function(){return t}))},Frame:function(t,e){var i=e.prefix;t.magic("".concat(i,"frame"),(function(){return function(t){var e=function(){t(),requestAnimationFrame(e)};e()}}))}};const Le=function(t){return function(e){var i=Pe({prefix:""},t);Object.keys(Re).forEach((function(t){Re[t](e,i)}))}}})(),o})()));